(this.webpackJsonpspotify_app_frontend=this.webpackJsonpspotify_app_frontend||[]).push([[0],{50:function(e,t,a){e.exports=a.p+"static/media/tonalify.8482fd0a.svg"},57:function(e,t,a){e.exports=a(91)},62:function(e,t,a){},63:function(e,t,a){},64:function(e,t,a){},91:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(31),l=a.n(r),i=(a(62),a(63),a(64),a(15)),c=a(4),o=a(18),u=a(48),m=a(49),d=a(28),p=(a(69),a(3)),h=[];var f=a(14),y={isAuthenticated:!1,id:null};var g=[];var b={isLoading:!1,requests:[]};var E,v,k={trackSelection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_SELECTION":return Object(p.a)(t.payload);default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"AUTHENTICATE":return Object(f.a)({},e,{isAuthenticated:!0,id:t.payload});case"DEAUTHENTICATE":return Object(f.a)({},e,{isAuthenticated:!1,id:null});default:return e}},flashMessages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_FLASH_MESSAGE":return[].concat(Object(p.a)(e),[t.payload]);case"DELETE_FLASH_MESSAGE":return Object(p.a)(e).filter((function(e){return e.id!=t.payload}));default:return e}},ajax:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_PENDING_REQUEST":return Object(f.a)({},e,{requests:[].concat(Object(p.a)(e.requests),[t.payload])});case"FINISH_PENDING_REQUEST":return Object(f.a)({},e,{requests:Object(p.a)(e.requests).filter((function(e){return!!e.id===t.payload}))});case"IS_LOADING":return Object(f.a)({},e,{isLoading:t.payload});default:return e}}},S=a(7),N=a(8),A=a(10),x=a(9),w="https://yfitops.herokuapp.com",_="https://tonalify.herokuapp.com";!function(e){e[e.PROFILE=0]="PROFILE",e[e.USER_LIBRARY=1]="USER_LIBRARY"}(E||(E={})),function(e){e[e.ERROR=0]="ERROR",e[e.SUCCESS=1]="SUCCESS"}(v||(v={}));var T={0:"C",1:"C#",2:"D",3:"D#",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"A#",11:"B"},C={0:"minor",1:"major"},O={3:"3/4",4:"4/4",5:"5/4",6:"6/4",7:"7/4"},R=function(e){Object(A.a)(a,e);var t=Object(x.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={message:null},n}return Object(N.a)(a,[{key:"componentDidUpdate",value:function(e){var t=e.flashMessages[e.flashMessages.length-1],a=this.props.flashMessages[this.props.flashMessages.length-1];(a&&t&&a.id!==t.id||!t&&a)&&this.renderFlashMessage()}},{key:"renderFlashMessage",value:function(){var e=this,t=this.props.flashMessages[this.props.flashMessages.length-1];t&&setTimeout((function(){e.props.deleteFlashMessage(t.id)}),5e3)}},{key:"render",value:function(){var e=this.props.flashMessages,t=e[e.length-1];return s.a.createElement("div",{className:"flash-messages-wrapper"},t?s.a.createElement("div",{className:"flash-message-content"},t.type===v.SUCCESS?s.a.createElement("div",{className:"notification is-success"},t.text):null,t.type===v.ERROR?s.a.createElement("div",{className:"notification is-danger"},t.text):null):null)}}]),a}(n.Component),j=Object(c.b)((function(e){return{flashMessages:e.flashMessages}}),(function(e){return{deleteFlashMessage:function(t){return e({type:"DELETE_FLASH_MESSAGE",payload:t})}}}))(R),I=a(2),P=a.n(I),q=a(11),D=a(6),F=a(5),L=a.n(F),M=a(102),U=a(50),B=a.n(U),G=function(){var e=Object(q.a)(P.a.mark((function e(t,a,n){var s,r;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Object(M.a)(),e.prev=1,t({id:s,type:E.PROFILE,message:"Logging In"}),e.next=5,L.a.get("".concat(w,"/login"));case 5:if(r=e.sent,a(s),!r||!r.data){e.next=10;break}return window.location.href=r.data,e.abrupt("return");case 10:n({type:v.ERROR,text:"Error Fetching Login URL",id:Object(M.a)()}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),a(s),n({type:v.ERROR,text:"Error Fetching Login URL",id:Object(M.a)()});case 17:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t,a,n){return e.apply(this,arguments)}}(),H=function(e){Object(A.a)(a,e);var t=Object(x.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={mobile:!1},n}return Object(N.a)(a,[{key:"logout",value:function(){var e=Object(q.a)(P.a.mark((function e(){var t,a;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(M.a)(),this.props.addPendingRequest({id:t,type:E.PROFILE,message:"Logging Out"}),e.next=4,L.a.get("".concat(w,"/logout"),{withCredentials:!0});case 4:if(a=e.sent,this.props.finishPendingRequest(t),a&&a.data){e.next=8;break}return e.abrupt("return");case 8:localStorage.removeItem("logged_in_tonalify"),this.props.deauthenticate();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=this.props,t=e.addPendingRequest,a=e.finishPendingRequest,n=e.addFlashMessage;G(t,a,n)}},{key:"clickHamburger",value:function(){this.setState({mobile:!this.state.mobile})}},{key:"render",value:function(){var e=this,t=this.props.isAuthenticated;return s.a.createElement("nav",{className:"navbar-wrapper navbar is-spaced"},s.a.createElement("div",{className:"navbar-brand"},s.a.createElement(D.a,{className:"navbar-tonalify-link navbar-item is-family-sans-serif has-text-primary has-text-weight-bold",to:"/home"},s.a.createElement("img",{src:B.a})),s.a.createElement("a",{role:"button",className:"navbar-burger burger ".concat(this.state.mobile?"is-active":""),"aria-label":"menu","data-target":"nav-menu",onClick:function(t){return e.clickHamburger()}},s.a.createElement("span",{"aria-hidden":"true"}),s.a.createElement("span",{"aria-hidden":"true"}),s.a.createElement("span",{"aria-hidden":"true"}))),s.a.createElement("div",{id:"nav-menu",className:"navbar-menu ".concat(this.state.mobile?"is-active":"")},s.a.createElement("div",{className:"navbar-start"},s.a.createElement(D.a,{className:"navbar-item",to:"/home",activeClassName:"is-active"},"Home"),t?s.a.createElement(n.Fragment,null,s.a.createElement(D.a,{className:"navbar-item",to:"/search",activeClassName:"is-active"},"Search"),s.a.createElement(D.a,{className:"navbar-item",to:"/your-playlists",activeClassName:"is-active"},"Playlists"),s.a.createElement(D.a,{className:"navbar-item",to:"/your-albums",activeClassName:"is-active"},"Albums")):null,s.a.createElement(D.a,{className:"navbar-item",to:"/selection",activeClassName:"is-active"},"Export")),s.a.createElement("div",{className:"navbar-end"},s.a.createElement("div",{className:"navbar-item"},s.a.createElement("div",{className:"buttons"},this.props.isAuthenticated?s.a.createElement("a",{className:"button is-light",onClick:function(){return e.logout()}},"Logout"):s.a.createElement("a",{className:"button is-light",onClick:function(){return e.login()}},"Login"))))))}}]),a}(n.Component);var z=Object(c.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{deauthenticate:function(){return e({type:"DEAUTHENTICATE"})},addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}}))(H),J=a(55),Y=a.n(J),Q=a(32),K=a.n(Q),W=a(27),X=a.n(W),Z=a(21),$=a.n(Z);function V(){try{localStorage.setItem("test","test"),localStorage.removeItem("test")}catch(e){if("QUATA_EXCEEDED_ERR"===e.name||"NS_ERROR_DOM_QUATA_REACHED"===e.name)return void alert("local storage is full, clear cache to continue");try{if(0===localStorage.remainingSpace)return void alert("local storage is full, clear cache to continue")}catch(e){}return void alert("local storage is required to continue")}}var ee=a(53),te=a.n(ee),ae=a(54),ne=a.n(ae),se=a(36),re=function(e){return e.dispatchEvent(new CustomEvent("disableBodyScroll",{bubbles:!0}))},le=function(){var e="hidden"==document.body.style.overflow;document.documentElement.style.overflowY=e?"hidden":"scroll"};document.addEventListener("enableBodyScroll",(function(e){var t=e.target;se.b(t),setTimeout(le,0)})),document.addEventListener("disableBodyScroll",(function(e){var t=e.target;se.a(t),setTimeout(le,0)}));var ie=function(e){Object(A.a)(a,e);var t=Object(x.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={fetchingAnalysis:!1,trackAnalysis:null,altAnalysis:null,fetchingAltAnalysis:!1,showAltAnalysis:!1},n}return Object(N.a)(a,[{key:"componentDidMount",value:function(){re(document.querySelector("#modal-content")),this.getAnalysis()}},{key:"numberToColorHsl",value:function(e){function t(e,t,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?e+6*(t-e)*a:a<.5?t:a<2/3?e+(t-e)*(2/3-a)*6:e}var a=function(e,a,n){var s,r,l;if(0==a)s=r=l=n;else{var i=n<.5?n*(1+a):n+a-n*a,c=2*n-i;s=t(c,i,e+1/3),r=t(c,i,e),l=t(c,i,e-1/3)}return[Math.floor(255*s),Math.floor(255*r),Math.floor(255*l)]}(1.2*(e*=100)/360,1,.5);return a[0]+","+a[1]+","+a[2]}},{key:"getAcousticBrainzAnalysis",value:function(){var e=Object(q.a)(P.a.mark((function e(t){var a,n,s,r,l,i,c,o,u;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.external_ids&&t.external_ids.isrc){e.next=2;break}return e.abrupt("return");case 2:if(a=localStorage.getItem(t.id),!(n=JSON.parse(a))||!n.altAnalysis){e.next=7;break}return this.setState({altAnalysis:n.altAnalysis,fetchingAltAnalysis:!1}),e.abrupt("return");case 7:return this.setState({fetchingAltAnalysis:!0}),e.next=10,L.a.post("".concat(w,"/musicbrainz"),t,{headers:{"Access-Control-Allow-Origin":_}});case 10:if((s=e.sent)&&s.data&&s.data.tonal){e.next=14;break}return this.setState({altAnalysis:null,fetchingAltAnalysis:!1}),e.abrupt("return");case 14:(r=s.data).metadata&&r.metadata.tags&&(l=r.metadata.tags,i=l.title,c=l.album,o=l.artist,i&&i.length&&(r.title=i[0]),c&&c.length&&(r.album=c[0]),o&&o.length&&(r.artist=o[0])),this.setState({altAnalysis:r,fetchingAltAnalysis:!1}),u={analysis:n&&n.analysis?n.analysis:"",altAnalysis:{title:r.title,album:r.album,artist:r.artist,tonal:{key_key:r.tonal.key_key,key_scale:r.tonal.key_scale,key_strength:r.tonal.key_strength,chords_key:r.tonal.chords_key,chords_scale:r.tonal.chords_scale},rhythm:{bpm:r.rhythm?r.rhythm.bpm:null}}},localStorage.setItem(t.id,JSON.stringify(u));case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAnalysis",value:function(){var e=Object(q.a)(P.a.mark((function e(){var t,a,n,s,r,l,i;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.track,a=localStorage.getItem(t.id),!(n=JSON.parse(a))||!n.analysis){e.next=7;break}return this.setState({trackAnalysis:n.analysis,fetchingAnalysis:!1}),this.getAcousticBrainzAnalysis(t),e.abrupt("return");case 7:return s=Object(M.a)(),this.props.addPendingRequest({id:s,type:E.USER_LIBRARY,message:"Fetching Audio Details"}),this.setState({fetchingAnalysis:!0,fetchingAltAnalysis:!1,altAnalysis:null},(function(){re(document.querySelector("#modal-content"))})),e.next=12,L.a.post("".concat(w,"/").concat(this.props.searchResults?"spotify-search":"spotify-request"),{spotify_path:"https://api.spotify.com/v1/audio-analysis/".concat(t.id),spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":_}});case 12:if(r=e.sent,this.props.finishPendingRequest(s),r&&r.data){e.next=16;break}return e.abrupt("return");case 16:this.setState({trackAnalysis:r.data,fetchingAnalysis:!1}),l=r.data.track,i={analysis:{sections:r.data.sections?r.data.sections:null,track:l?{key:l.key,key_confidence:l.key_confidence,mode:l.mode,mode_confidence:l.mode_confidence,time_signature:l.time_signature,time_signature_confidence:l.time_signature_confidence,tempo:l.tempo,tempo_confidence:l.tempo_confidence}:null}},localStorage.setItem(t.id,JSON.stringify(i)),this.getAcousticBrainzAnalysis(t);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"closeModal",value:function(){document.querySelector("#modal-content").dispatchEvent(new CustomEvent("enableBodyScroll",{bubbles:!0})),this.props.closeModal()}},{key:"updateSelection",value:function(e){var t=this.props.track,a=localStorage.getItem("tonalify_selection"),n=(JSON.parse(a)?JSON.parse(a):[]).map((function(a){return a.id!==t.id?a:Object(f.a)({},a,{},e)}));localStorage.setItem("tonalify_selection",JSON.stringify(n)),this.props.refreshSelection&&this.props.refreshSelection()}},{key:"render",value:function(){var e=this,t=this.props,a=t.track,n=t.trackSelection,r=t.addToSelection,l=t.removeFromSelection,i=this.state,c=i.fetchingAnalysis,o=i.fetchingAltAnalysis,u=i.trackAnalysis,m=i.altAnalysis,d=i.showAltAnalysis,p=m&&m.tonal?m.tonal:null,h=m&&m.rhythm?m.rhythm:null,f=localStorage.getItem("tonalify_selection"),y=JSON.parse(f).find((function(e){if(e.id===a.id)return e}));return s.a.createElement("div",{className:"modal is-active"},s.a.createElement("div",{className:"modal-background",onClick:function(){e.closeModal()}}),s.a.createElement("div",{id:"modal-content",className:"modal-content has-background-light"},!c&&u?s.a.createElement("div",{style:{position:"absolute",top:"0",left:"50%",transform:"translateX(-50%)",width:"100%",height:"20px",background:"linear-gradient(to right,rgba(255,0,0,0.5)0%,rgba(255,255,0,0.5) 50%,rgba(0,255,0,0.5) 100%)",display:"inline-flex",justifyContent:"space-between",alignItems:"center",padding:"2px"}},s.a.createElement("p",null,"0%"),s.a.createElement("p",null,"analysis confidence"),s.a.createElement("p",null,"100%")):null,!c&&u&&u.track?s.a.createElement("div",{className:"track-analysis-content"},s.a.createElement("div",{style:{marginTop:"20px",display:"inline-flex",justifyContent:"space-between",width:"100%"}},s.a.createElement("div",null,s.a.createElement("h2",{className:"is-size-4"},a.name?a.name:null),s.a.createElement("h2",{className:"is-size-7"},a.album&&a.album.name?a.album.name:null),s.a.createElement("h2",{className:"is-size-7"},a.artist?a.artist:null)),n.find((function(e){return e.id===a.id}))?s.a.createElement("div",{className:"has-text-link",style:{display:"inline-flex",justifyContent:"space-between",cursor:"pointer"},onClick:function(){l(a)}},"deselect",s.a.createElement(X.a,{className:"selection-button-icon"})):s.a.createElement("div",{className:"has-text-link",style:{display:"inline-flex",justifyContent:"space-between",cursor:"pointer"},onClick:function(){r(a)}},"select",s.a.createElement(K.a,{className:"selection-button-icon"}))),m&&p&&!d?s.a.createElement("div",{className:"has-text-link",onClick:function(){e.setState({showAltAnalysis:!0})},style:{display:"inline-flex",alignItems:"center",cursor:"pointer"}},s.a.createElement("p",null,"MusicBrainz"),s.a.createElement(te.a,{className:"icon is-medium"})):null,m&&p&&d?s.a.createElement("div",null," ",s.a.createElement("hr",null),s.a.createElement("p",{style:{textAlign:"center"}},"MusicBrainz API, Possible Match"),s.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center"}},s.a.createElement("div",{onClick:function(){e.setState({showAltAnalysis:!1})},style:{display:"inline-flex",alignItems:"center",cursor:"pointer"}}," ",s.a.createElement("p",{style:{textAlign:"center",margin:"5px"}},"see less"),s.a.createElement(ne.a,{className:"icon is-medium"}))),s.a.createElement("div",{className:"",style:{display:"flex",flexWrap:"wrap"}},s.a.createElement("div",{style:{flexBasis:0,flexGrow:1}},m.title?s.a.createElement("div",{style:{margin:"5px"}},s.a.createElement("p",{className:"is-size-7"},"Title"),s.a.createElement("p",null,m.title)):null,m.album?s.a.createElement("div",{style:{margin:"5px"}},s.a.createElement("p",{className:"is-size-7"},"Album "),s.a.createElement("p",null,m.album)):null,m.artist?s.a.createElement("div",{style:{margin:"5px"}},s.a.createElement("p",{className:"is-size-7"},"Artist"),s.a.createElement("p",null,m.artist)):null),s.a.createElement("div",{style:{flexBasis:0,flexGrow:1,display:"flex",flexWrap:"wrap",justifyContent:"center"}},p.key_key&&p.key_scale?s.a.createElement("div",{style:{margin:"5px",border:"1px solid grey",borderRadius:"5px",padding:"5px",flexBasis:0,flexGrow:1}},s.a.createElement("p",{style:{whiteSpace:"nowrap"}},p.key_key," ",p.key_scale),p.key_strength&&p.key_strength.toFixed(2)?s.a.createElement("p",{className:"is-size-7",style:{whiteSpace:"nowrap"}},"Strength ",p.key_strength.toFixed(2)):null):null,p.chords_key&&p.chords_scale?s.a.createElement("div",{style:{margin:"5px",border:"1px solid grey",borderRadius:"5px",padding:"5px",flexBasis:0,flexGrow:1}},s.a.createElement("p",{className:"is-size-7",style:{whiteSpace:"nowrap"}},"Chords Key"),s.a.createElement("p",{style:{whiteSpace:"nowrap"}},p.chords_key," ",p.chords_scale)):null,h&&h.bpm?s.a.createElement("div",{style:{margin:"5px",border:"1px solid grey",borderRadius:"5px",padding:"5px",flexBasis:0,flexGrow:1}},s.a.createElement("p",{className:"is-size-7"},"BPM"),s.a.createElement("p",null,h.bpm.toFixed())):null))," ",y?s.a.createElement("div",{style:{marginTop:"10px"}},s.a.createElement("p",{style:{textAlign:"center"}},"Use MusicBrainz instead of Spotify?"),s.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},s.a.createElement("label",{className:"checkbox",style:{margin:"5px"}},s.a.createElement("input",{checked:!!y.altKey,onClick:function(){return e.updateSelection({altKey:y.altKey?null:p.key_key})},type:"checkbox"}),"Key"),s.a.createElement("label",{className:"checkbox",style:{margin:"5px"}},s.a.createElement("input",{checked:!!y.altMode,onClick:function(){return e.updateSelection({altMode:y.altMode?null:p.key_scale})},type:"checkbox"}),"Mode"),s.a.createElement("label",{className:"checkbox",style:{margin:"5px"}},s.a.createElement("input",{checked:!!y.altTempo,onClick:function(){return e.updateSelection({altTempo:y.altTempo?null:h.bpm.toFixed()})},type:"checkbox"}),"Tempo"))):null,s.a.createElement("hr",null)):null,o?s.a.createElement("p",{className:"is-size-7",style:{textAlign:"center"}},"...fetching alternate analysis"):null,o||m&&m.tonal?null:s.a.createElement("p",{className:"is-size-7",style:{textAlign:"center"}},"no alternate analysis found"),s.a.createElement("p",{style:{textAlign:"center",marginTop:"10px"}},"Spotify API"," "),s.a.createElement("div",{style:{display:"flex",width:"100%",justifyContent:"center"}},s.a.createElement("div",{className:"confidence-bar",style:{backgroundColor:"rgba(".concat(this.numberToColorHsl(u.track.key_confidence),",0.5)")}},s.a.createElement("p",null,T[u.track.key])),s.a.createElement("div",{className:"confidence-bar",style:{backgroundColor:"rgba(".concat(this.numberToColorHsl(u.track.mode_confidence),",0.5)")}},s.a.createElement("p",null,C[u.track.mode])),s.a.createElement("div",{className:"confidence-bar",style:{overflow:"visible !important",backgroundColor:"rgba(".concat(this.numberToColorHsl(u.track.tempo_confidence),",0.5)")}},s.a.createElement("p",null,u.track.tempo.toFixed(2))),s.a.createElement("div",{className:"confidence-bar",style:{backgroundColor:"rgba(".concat(this.numberToColorHsl(u.track.time_signature_confidence),",0.5)")}},s.a.createElement("p",null,O[u.track.time_signature]))),s.a.createElement("div",{className:"table-wrapper card"},s.a.createElement("table",{className:"table is-bordered is-striped"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"section"),s.a.createElement("th",null,"start"),s.a.createElement("th",null,"duration"),s.a.createElement("th",null,"key"),s.a.createElement("th",null,"mode"),s.a.createElement("th",null,"tempo"),s.a.createElement("th",null,"meter"))),s.a.createElement("tbody",null,u.sections.map((function(t,a){return s.a.createElement("tr",{key:Object(M.a)()},s.a.createElement("td",{style:{backgroundColor:"rgba(".concat(e.numberToColorHsl(t.confidence),",0.5")}},a+1),s.a.createElement("td",{style:{backgroundColor:"rgba(".concat(e.numberToColorHsl(t.confidence),",0.5")}},new Date(1e3*t.start).toISOString().substr(11,8)),s.a.createElement("td",{style:{backgroundColor:"rgba(".concat(e.numberToColorHsl(t.confidence),",0.5")}},new Date(1e3*t.duration).toISOString().substr(11,8)),s.a.createElement("td",{style:{backgroundColor:"rgba(".concat(e.numberToColorHsl(t.key_confidence),",0.5")}},T[t.key]),s.a.createElement("td",{style:{backgroundColor:"rgba(".concat(e.numberToColorHsl(t.mode_confidence),",0.5")}},C[t.mode]),s.a.createElement("td",{style:{backgroundColor:"rgba(".concat(e.numberToColorHsl(t.tempo_confidence),",0.5")}},t.tempo.toFixed(2)),s.a.createElement("td",{style:{backgroundColor:"rgba(".concat(e.numberToColorHsl(t.time_signature_confidence),",0.5")}},O[t.time_signature]))})))))):null),s.a.createElement("button",{className:"modal-close is-large","aria-label":"close",onClick:function(){e.closeModal()}}))}}]),a}(n.Component);var ce=Object(c.b)((function(e){return{}}),(function(e){return{authenticate:function(){return e({type:"AUTHENTICATE"})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}}))(ie),oe=function(e,t,a,n){return e===t?s.a.createElement("th",{onClick:function(e){return n(e)}},e,0!==a&&a?null:s.a.createElement(s.a.Fragment,null,"\u2191\u2193"),1===a?s.a.createElement(s.a.Fragment,null,"\u2191"):null,2===a?s.a.createElement(s.a.Fragment,null,"\u2193"):null):s.a.createElement("th",{onClick:function(e){n(e)}},e,"\u2191\u2193")},ue=function(e){Object(A.a)(a,e);var t=Object(x.a)(a);function a(e){var n;Object(S.a)(this,a),n=t.call(this,e);var s=localStorage.getItem("tonalify_selection"),r=JSON.parse(s);return n.state={trackList:[],spotifyPath:localStorage.getItem("spotify_path"),filtered:!1,key:null,mode:null,sort:{column:null,direction:null},errorFetchingTracks:!1,disableTable:!1,query:"",trackSelection:r||[],modalActive:!1,trackToAnalyze:{},next:!1},V(),n.getTracks(),n}return Object(N.a)(a,[{key:"getTracks",value:function(){var e=Object(q.a)(P.a.mark((function e(){var t,a,n,s,r,l,i,c,o,u,m;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(M.a)(),a=Object(M.a)(),e.prev=2,this.props.addPendingRequest({id:t,type:E.USER_LIBRARY,message:"Fetching Tracks"}),e.next=6,L.a.post("".concat(w,"/").concat(this.props.searchResults?"spotify-search":"spotify-request"),{spotify_path:this.state.spotifyPath,spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":_}});case 6:if(n=e.sent,this.props.finishPendingRequest(t),n.data){e.next=10;break}return e.abrupt("return");case 10:return s=n.data,r=s.next,l=s.items,(i=s.tracks)&&i.items&&(r=i.next),c=l||i,c=i&&i.items?i.items:c,this.props.addPendingRequest({id:a,type:E.USER_LIBRARY,message:"Fetching Audio Details"}),e.next=17,L.a.post("".concat(w,"/").concat(this.props.searchResults?"spotify-search":"spotify-request"),{spotify_path:"https://api.spotify.com/v1/audio-features?ids=".concat(c.map((function(e){return e.track&&(e=e.track),e.id}))),spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":_}});case 17:o=e.sent,this.props.finishPendingRequest(a),u=[],o&&o.data&&o.data.audio_features&&(u=o.data.audio_features),m=Object(p.a)(this.state.trackList).concat(c.map((function(e){e.track&&(e=e.track);var t=u.find((function(t){return t&&e&&t.id===e.id}));return Object(f.a)({},e,{selected:!1,tempo:t?t.tempo:null,key:t?T[t.key]:null,mode:t?C[t.mode]:null,artist:e.artists&&e.artists.length?e.artists[0].name:null,albumName:e.album&&e.album.name?e.album.name:null})}))),this.setState(Object(f.a)({},this.state,{trackList:m,spotifyPath:r,next:!(!r||!r.length),errorFetchingTracks:!1}),(function(){})),e.next=30;break;case 25:e.prev=25,e.t0=e.catch(2),this.props.finishPendingRequest(t),this.props.finishPendingRequest(a),this.setState(Object(f.a)({},this.state,{errorFetchingTracks:!0}));case 30:case"end":return e.stop()}}),e,this,[[2,25]])})));return function(){return e.apply(this,arguments)}}()},{key:"filterByKey",value:function(e){"key"!==e.target.name?"mode"===e.target.name&&this.setState({mode:e.target.value,filtered:!!e.target.value||!!this.state.key}):this.setState({key:e.target.value,filtered:!!e.target.value||!!this.state.mode})}},{key:"search",value:function(e){e.target.value&&e.target.value.length?this.setState({query:e.target.value,filtered:!0}):this.setState({query:"",filtered:!1})}},{key:"getFilteredTracks",value:function(){var e=this,t=this.state,a=t.key,n=t.mode,s=Object(p.a)(this.state.trackList).filter((function(e){return a&&n&&e.key===a&&e.mode===n||a&&!n&&e.key===a||!a&&n&&e.mode===n?e:a||n?void 0:e}));return this.state.query?s.filter((function(t){var a=t.name,n=t.artist,s=t.tempo,r=t.mode,l=t.key,i=!1;if([a,n,s,r,l].map((function(t){t&&t.toString().toLowerCase().includes(e.state.query.toLocaleLowerCase())&&(i=!0)})),i)return t})):s}},{key:"addToSelection",value:function(e){var t=localStorage.getItem("tonalify_selection"),a=JSON.parse(t)?JSON.parse(t):[],n=[].concat(Object(p.a)(a),[e]);localStorage.setItem("tonalify_selection",JSON.stringify(n)),this.setState({trackSelection:n})}},{key:"removeFromSelection",value:function(e){var t=localStorage.getItem("tonalify_selection"),a=(JSON.parse(t)?JSON.parse(t):[]).filter((function(t){return t.id!==e.id}));localStorage.setItem("tonalify_selection",JSON.stringify(a)),this.setState({trackSelection:a})}},{key:"sortColumn",value:function(e){var t=1;if(this.state.sort.column!==e)t=1;else switch(this.state.sort.direction){case 0:t=1;break;case 1:t=2;break;case 2:t=0}this.setState({sort:{column:e,direction:t}})}},{key:"getSortedTracks",value:function(e){var t=this.state.sort,a=t.direction,n=t.column;return Object(p.a)(e).sort((function(e,t){return 1===a?e[n]>t[n]?1:-1:2===a?e[n]<t[n]?1:-1:1}))}},{key:"closeModal",value:function(){this.setState({modalActive:!1})}},{key:"refreshSelection",value:function(){var e=localStorage.getItem("tonalify_selection"),t=JSON.parse(e);this.setState({trackSelection:t})}},{key:"render",value:function(){var e=this,t=this.state.filtered?this.getFilteredTracks():this.state.trackList,a=this.getSortedTracks(t),n=localStorage.getItem("spotify_item_title"),r=this.state,l=r.trackToAnalyze,i=r.trackSelection,c=r.next;return s.a.createElement("div",{className:"tracks-view-wrapper"},this.state.modalActive?s.a.createElement(ce,{track:l,searchResults:this.props.searchResults,addToSelection:function(t){return e.addToSelection(t)},removeFromSelection:function(t){return e.removeFromSelection(t)},closeModal:function(){return e.closeModal()},trackSelection:i,refreshSelection:function(){return e.refreshSelection()}}):null,this.state.errorFetchingTracks?s.a.createElement("p",{className:"notification is-danger"},"Error Loading Tracks, Refresh the Page"):s.a.createElement("div",{className:"tracks-view-content"},s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container has-text-centered is-widescreen"},s.a.createElement("p",{className:"title"},n),s.a.createElement("p",null,"This won't modify ",n," or your library, selecting and deselecting tracks only modifies your selection of tracks in this app. Use the table below to select and deselect tracks."," ",s.a.createElement(D.a,{to:"/selection"},"Export")," to modify and export your full selection of tracks, or continue to"," ",s.a.createElement(D.a,{to:"/your-playlists"},"Playlists")," and"," ",s.a.createElement(D.a,{to:"/your-albums"},"Albums")," to continue adding tracks"," "))),s.a.createElement("div",{className:"table-section-wrapper"},s.a.createElement("div",{className:"table-wrapper"},this.state.disableTable?s.a.createElement("div",{className:"table-ajax-cover"},s.a.createElement("div",{className:"ajax-spinner"},s.a.createElement("div",{className:"spinner"}))):null,s.a.createElement("div",{className:"table-controls-wrapper"},s.a.createElement("div",{className:"key-and-mode-filter-wrapper"},s.a.createElement("form",{onChange:function(t){e.filterByKey(t)}},s.a.createElement("div",{className:"filter-wrapper"},s.a.createElement("div",{className:"select"},s.a.createElement("select",{name:"key"},s.a.createElement("option",{selected:!this.state.key,disabled:!0,value:""},"Key"),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map((function(e){return s.a.createElement("option",{key:Object(M.a)(),value:e},e)})))),this.state.key?s.a.createElement("button",{onClick:function(t){return e.setState({key:null})}},s.a.createElement($.a,{className:"has-text-link"})):null),s.a.createElement("div",{className:"filter-wrapper"},s.a.createElement("div",{className:"select"},s.a.createElement("select",{name:"mode"},s.a.createElement("option",{selected:!this.state.mode,disabled:!0,value:""},"mode"),s.a.createElement("option",{value:"major"},"major"),s.a.createElement("option",{value:"minor"},"minor"))),this.state.mode?s.a.createElement("button",{onClick:function(t){return e.setState({mode:null})}},s.a.createElement($.a,{className:"has-text-link"})):null))),s.a.createElement("div",{className:"search-input-wrapper"},s.a.createElement("input",{className:"input is-small",onChange:function(t){return e.search(t)},placeholder:"Search",value:this.state.query}),this.state.query.length?s.a.createElement("button",{onClick:function(){e.setState({query:""})}},s.a.createElement($.a,{className:"has-text-link"})):null)),s.a.createElement("table",{className:"table is-bordered is-striped"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"select"),oe("name",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("name")})),oe("key",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("key")})),oe("mode",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("mode")})),oe("tempo",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("tempo")})),oe("artist",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("artist")})),oe("album",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("albumName")})))),s.a.createElement("tbody",null,a.map((function(t){return s.a.createElement("tr",{key:Object(M.a)()},s.a.createElement("td",{align:"center"},e.state.trackSelection.find((function(e){return e&&t&&e.id===t.id}))?s.a.createElement(X.a,{className:"selection-button-icon has-text-link ".concat(e.state.disableTable?"disabled-icon":""),onClick:function(){e.removeFromSelection(t)}}):s.a.createElement(K.a,{className:"selection-button-icon has-text-link ".concat(e.state.disableTable?"disabled-icon":""),onClick:function(){e.addToSelection(t)}})),s.a.createElement("td",null,s.a.createElement("a",{onClick:function(){e.setState({modalActive:!0,trackToAnalyze:t})}},t.name)),s.a.createElement("td",null,t.key),s.a.createElement("td",null,t.mode),s.a.createElement("td",null,Number(t.tempo).toFixed(2)),s.a.createElement("td",null,t.artist),s.a.createElement("td",null,t.albumName))})))),c?s.a.createElement("button",{onClick:function(){return e.getTracks()},className:"button"},"load more"):"end of results"))))}}]),a}(n.Component);var me,de=Object(c.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}}))(ue);!function(e){e.ARTIST="ARTIST",e.TRACK="TRACK"}(me||(me={}));var pe=function(e){Object(A.a)(a,e);var t=Object(x.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={itemList:[],filtered:!1,sort:{column:null,direction:null},errorFetchingItems:!1,disableTable:!1,query:"",next:!1,searchBy:me.TRACK,artists:[],artistsPath:"",nextArtists:"",albums:[],albumsPath:"",nextAlbums:"",selectedAlbum:null,showAlbumTracksTable:!1,showTracksTable:!1,showArtistAlbums:!0},V(),n}return Object(N.a)(a,[{key:"search",value:function(e){var t=this;e.preventDefault();var a=this.state,n=a.searchBy,s=a.query;n===me.TRACK&&(localStorage.setItem("spotify_path","https://api.spotify.com/v1/search?q=".concat(s,"&type=").concat(n.toLowerCase(),"&market=US")),localStorage.setItem("spotify_item_title",s),this.setState({showTracksTable:!1,showAlbumTracksTable:!1},(function(){t.setState({showTracksTable:!0})}))),n===me.ARTIST&&this.setState({artists:[],nextArtists:"",albums:[]},(function(){t.getArtists()})),this.setState({filtered:!0})}},{key:"getArtists",value:function(){var e=Object(q.a)(P.a.mark((function e(){var t,a,n,s,r;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state,a=t.query,n=t.nextArtists,s=Object(M.a)(),this.props.addPendingRequest({id:s,type:E.USER_LIBRARY,message:"Fetching Artists"}),e.prev=3,e.next=6,L.a.post("".concat(w,"/spotify-search"),{spotify_path:n&&n.length?n:"https://api.spotify.com/v1/search?q=".concat(a,"&type=artist&market=US"),is_tracks:!1},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":_}});case 6:if((r=e.sent)&&r.data&&r.data.artists){e.next=9;break}return e.abrupt("return");case 9:this.setState({artists:[].concat(Object(p.a)(this.state.artists),Object(p.a)(r.data.artists.items)),nextArtists:r.data.artists.next,showArtistAlbums:!0}),this.props.finishPendingRequest(s),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),this.props.finishPendingRequest(s);case 16:case"end":return e.stop()}}),e,this,[[3,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"getAlbums",value:function(){var e=Object(q.a)(P.a.mark((function e(t){var a,n,s;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.state.nextAlbums,n=Object(M.a)(),this.props.addPendingRequest({id:n,type:E.USER_LIBRARY,message:"Fetching Albums"}),e.prev=3,e.next=6,L.a.post("".concat(w,"/spotify-search"),{spotify_path:a&&a.length?a:"https://api.spotify.com/v1/artists/".concat(t,"/albums?market=US"),is_tracks:!1},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":_}});case 6:if(s=e.sent,this.props.finishPendingRequest(n),s&&s.data){e.next=10;break}return e.abrupt("return");case 10:this.setState({albums:[].concat(Object(p.a)(this.state.albums),Object(p.a)(s.data.items)),nextAlbums:s.data.next}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),this.props.finishPendingRequest(n);case 16:case"end":return e.stop()}}),e,this,[[3,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.searchBy,n=t.artists,r=t.nextArtists,l=t.albums,i=t.nextAlbums,c=t.showAlbumTracksTable,o=t.showTracksTable,u=t.showArtistAlbums,m=this.props.isAuthenticated;return s.a.createElement("div",{className:"search-view-wrapper"},this.state.errorFetchingItems?s.a.createElement("p",{className:"notification is-danger"},"Error Loading Tracks, Refresh the Page"):s.a.createElement("div",{className:"search-view-content"},s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container has-text-centered playlists-and-albums-header"},s.a.createElement("p",{className:"title"},"Spotify Audio Analysis"),m?null:s.a.createElement("span",null,"If you wish to export playlists,"," ",s.a.createElement("a",{className:"",href:"",onClick:function(t){t.preventDefault(),e.props.login&&e.props.login()}},"Login")," ","with Spotify"))),s.a.createElement("div",{style:{display:"flex",alignContent:"center",flexDirection:"column",flexWrap:"wrap"}},s.a.createElement("div",{style:{display:"flex",justifyContent:"center",margin:"5px"}},s.a.createElement("button",{style:{margin:"2px"},className:"button is-outlined is-rounded ".concat(a===me.ARTIST?"is-active":""),onClick:function(){e.setState({searchBy:me.ARTIST,showAlbumTracksTable:!1,showTracksTable:!1})}},"artists"),s.a.createElement("button",{style:{margin:"2px"},className:"button is-outlined is-rounded ".concat(a===me.TRACK?"is-active":""),onClick:function(){e.setState({searchBy:me.TRACK,showAlbumTracksTable:!1,showTracksTable:!1})}},"tracks")),s.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},s.a.createElement("form",{style:{display:"inline-flex"}},s.a.createElement("input",{onChange:function(t){t.target.value&&t.target.value.length?e.setState({query:t.target.value}):e.setState({query:"",filtered:!1})},className:"input",placeholder:"search for ".concat(a.toLocaleLowerCase())}),s.a.createElement("button",{className:"button",type:"submit",onClick:function(t){e.search(t)}},s.a.createElement(Y.a,null))))),a===me.ARTIST?s.a.createElement("div",{style:{marginTop:"20px"}},u?s.a.createElement("div",{className:""},a===me.ARTIST&&n&&n.length?s.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},s.a.createElement("p",{style:{margin:"auto"}},"Select an Artist"),s.a.createElement("div",{style:{width:"100%",display:"inline-flex",overflowX:"scroll",justifyContent:"flex-start",margin:"10px"}},n.map((function(t){return s.a.createElement("button",{key:Object(M.a)(),className:"button",style:{flexShrink:0,color:"white",width:"auto",height:"100px",backgroundImage:'url("'.concat(t.images[2]?t.images[2].url:"",'")'),backgroundSize:"cover",backgroundPosition:"center",overflow:"hidden"},onClick:function(a){a.preventDefault(),e.setState({albums:[]},(function(){return e.getAlbums(t.id)}))}},s.a.createElement("p",{style:{color:"white",zIndex:5}},t.name),s.a.createElement("div",{style:{zIndex:1,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"100%",height:"100%",background:"rgba(0,0,0,.6)"}}))})),r?s.a.createElement("button",{className:"button",onClick:function(t){t.preventDefault(),e.getArtists()},style:{width:"auto",height:"100px",flexShrink:0}},"Load More"):null)):null,a===me.ARTIST&&l&&l.length?s.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},s.a.createElement("p",{style:{margin:"auto"}},"Select an Album"),s.a.createElement("div",{style:{width:"100%",display:"inline-flex",overflowX:"scroll",justifyContent:"flex-start",margin:"10px"}},l.map((function(t){return s.a.createElement("button",{key:Object(M.a)(),className:"button",style:{flexShrink:0,color:"white",width:"auto",height:"100px",backgroundImage:'url("'.concat(t.images&&t.images[2]&&t.images[2].url?t.images[2].url:"",'")'),backgroundSize:"cover",backgroundPosition:"center",overflow:"hidden"},onClick:function(a){a.preventDefault(),e.setState({showTracksTable:!1,showAlbumTracksTable:!1,showArtistAlbums:!1},(function(){localStorage.setItem("spotify_path","https://api.spotify.com/v1/albums/".concat(t.id,"/tracks")),localStorage.setItem("spotify_item_title",t.name),e.setState({showAlbumTracksTable:!0,selectedAlbum:t},(function(){}))}))}},s.a.createElement("p",{style:{color:"white",zIndex:5}},t.name),s.a.createElement("div",{style:{zIndex:1,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"100%",height:"100%",background:"rgba(0,0,0,.6)"}}))})),i?s.a.createElement("button",{className:"button",onClick:function(t){t.preventDefault(),e.getAlbums("")},style:{width:"auto",height:"100px",flexShrink:0}},"Load More"):null)):null):s.a.createElement("div",{className:"card",style:{display:"flex",justifyContent:"center"}},s.a.createElement("button",{className:"button",onClick:function(){e.setState({showArtistAlbums:!0})}},"Expand Search Results"))):null,c?s.a.createElement(de,{searchResults:!0}):null,o?s.a.createElement(de,{searchResults:!0}):null))}}]),a}(n.Component);var he=Object(o.compose)(i.f,Object(c.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}})))(pe),fe=function(e){Object(A.a)(a,e);var t=Object(x.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={},V(),n}return Object(N.a)(a,[{key:"render",value:function(){var e=this,t=this.props.isAuthenticated,a=localStorage.getItem("logged_in_tonalify")?localStorage.getItem("logged_in_tonalify"):this.props.displayName;return s.a.createElement("div",{className:"home-view-wrapper"},t?s.a.createElement("div",{className:"section"},s.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},s.a.createElement("div",{className:"has-text-centered",style:{maxWidth:"400px",display:"flex",alignItems:"center",flexDirection:"column"}},s.a.createElement("p",{className:"title"},"Welcome, ",a)," ",s.a.createElement("p",null,"Browse your library and make track selections based on key or tempo, then export your selection as a Spotify playlist. This app won't modify your playlists, it will only add new playlists that you create"))),s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container is-widescreen has-text-centered"},s.a.createElement("div",{className:"links"},s.a.createElement(D.a,{className:"link-card has-background-primary has-text-white is-size-4",to:"/search"},s.a.createElement("p",null,"Search")),s.a.createElement(D.a,{className:"link-card has-background-primary has-text-white is-size-4",to:"/your-albums"},s.a.createElement("p",null,"Your Albums")),s.a.createElement(D.a,{className:"link-card has-background-primary has-text-white is-size-4",to:"/your-playlists"},s.a.createElement("p",null,"Your Playlists")),s.a.createElement(D.a,{className:"link-card has-background-primary has-text-white is-size-4",to:"/selection"},s.a.createElement("p",null,"Export Selection"))),s.a.createElement("hr",null),s.a.createElement("div",{className:"buy-me-coffee-wrapper"},s.a.createElement("a",{className:"bmc-button has-background-link",href:"https://www.buymeacoffee.com/tonalify"},s.a.createElement("img",{src:"https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg",alt:"Buy me a coffee"}),s.a.createElement("span",{style:{marginLeft:"5px",fontSize:"19px !important"}},"Buy me a coffee")))))):null,t?null:s.a.createElement(he,{login:function(){return e.props.login()}}))}}]),a}(n.Component);var ye=Object(c.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{authenticate:function(t){return e({type:"AUTHENTICATE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})},addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})}}}))(fe),ge=function(e){Object(A.a)(a,e);var t=Object(x.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={collection:[],showTracks:!1,tracksPath:"",showTable:!1,selectedPlaylistPath:"",selectedPlaylistTitle:"",errorFetching:!1,query:"",spotifyPath:"PLAYLISTS"===n.props.type?"https://api.spotify.com/v1/me/playlists?limit=50":"https://api.spotify.com/v1/me/albums?limit=50",fetching:!1,collectionType:"PLAYLISTS"===n.props.type?"Playlist":"Album"},V(),n}return Object(N.a)(a,[{key:"componentDidMount",value:function(){this.getPlaylists()}},{key:"getPlaylists",value:function(){var e=Object(q.a)(P.a.mark((function e(){var t,a,n,s=this;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(M.a)(),e.prev=1,this.setState({fetching:!0}),this.props.addPendingRequest({id:t,type:E.USER_LIBRARY,message:"PLAYLISTS"===this.props.type?"Fetching Playlists":"Fetching Albums"}),e.next=6,L.a.post("".concat(w,"/spotify-request"),{spotify_path:this.state.spotifyPath,spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":_}});case 6:if(a=e.sent,this.props.finishPendingRequest(t),a&&a.data&&a.data.items){e.next=10;break}return e.abrupt("return");case 10:n=a.data.next,this.setState({collection:Object(p.a)(this.state.collection).concat("PLAYLISTS"===this.props.type?a.data.items:a.data.items.map((function(e){return e.album}))),spotifyPath:n,fetching:!1},(function(){n&&s.getPlaylists()})),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),this.props.finishPendingRequest(t),this.setState({errorFetching:!0,fetching:!1});case 18:case"end":return e.stop()}}),e,this,[[1,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"open",value:function(e,t){localStorage.setItem("spotify_path","https://api.spotify.com/v1/".concat("PLAYLISTS"===this.props.type?"playlists":"albums","/").concat(e,"/tracks")),localStorage.setItem("spotify_item_title",t),this.props.history.push("/tracks")}},{key:"search",value:function(e){this.setState({query:e})}},{key:"filterCollection",value:function(){var e=this;return Object(p.a)(this.state.collection).filter((function(t){var a=t.description,n=t.name,s=e.state.query.toLocaleLowerCase();if(a&&a.toString().toLowerCase().includes(s)||n&&n.toString().toLowerCase().includes(s))return t}))}},{key:"render",value:function(){var e=this,t=this.state.query&&this.state.query.length?this.filterCollection():this.state.collection;return s.a.createElement("div",{className:"playlists-view-wrapper"},s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container has-text-centered playlists-and-albums-header"},s.a.createElement("p",{className:"title"},"Your ",this.state.collectionType,"s"),s.a.createElement("p",null,"Choose ",this.state.collectionType," to Select Tracks From"))),s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container is-widescreen"},s.a.createElement("div",{className:"field"},s.a.createElement("label",{className:"label",htmlFor:"search-input"},"Search Your ",this.state.collectionType,"s"),s.a.createElement("div",{className:"search-playlists-input-wrapper"},s.a.createElement("input",{id:"search-input",className:"search-input input",onChange:function(t){return e.search(t.target.value)},placeholder:"Search",value:this.state.query}),this.state.query.length?s.a.createElement("button",{onClick:function(){e.setState({query:""})}},s.a.createElement($.a,{className:"has-text-link"})):null)),this.state.errorFetching?s.a.createElement("p",{className:"notification is-danger"},"Error Loading ",this.state.collectionType,"s, Refresh the Page"):s.a.createElement("div",{className:"playlists-wrapper"},t.length?t.map((function(t){return s.a.createElement("div",{style:{backgroundImage:t.images&&t.images[0]&&t.images[0].url?"url(".concat(t.images[0].url,")"):"none",backgroundSize:"cover",backgroundPosition:"center"},key:Object(M.a)(),className:"playlist-wrapper has-background-grey-lighter",onClick:function(){return e.open(t.id,t.name)}},s.a.createElement("p",{style:{color:"white",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",zIndex:5,padding:"10px",background:"rgba(0,0,0,.8)",borderRadius:"5px"}},t.name),s.a.createElement("div",{style:{width:"100%",height:"100%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",background:"rgba(0,0,0,.4)",zIndex:2}}))})):this.state.fetching?null:s.a.createElement("p",null,"no results")))))}}]),a}(n.Component);var be=Object(o.compose)(i.f,Object(c.b)((function(e){return{}}),(function(e){return{authenticate:function(){return e({type:"AUTHENTICATE"})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}})))(ge),Ee=function(e,t,a){var n=function(n){Object(A.a)(l,n);var r=Object(x.a)(l);function l(e){var t;return Object(S.a)(this,l),(t=r.call(this,e)).state={displayName:""},t}return Object(N.a)(l,[{key:"componentDidMount",value:function(){new URLSearchParams(window.location.search).get("code")?this.authenticateUser():this.checkAndRedirect()}},{key:"componentDidUpdate",value:function(){this.checkAndRedirect()}},{key:"login",value:function(){var e=this.props,t=e.addPendingRequest,a=e.finishPendingRequest,n=e.addFlashMessage;G(t,a,n)}},{key:"authenticateUser",value:function(){var e=Object(q.a)(P.a.mark((function e(){var t;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(M.a)(),e.prev=1,this.props.addPendingRequest({id:t,type:E.PROFILE,message:"Authenticating"}),e.next=5,L.a.get("".concat(w,"/authorize?code=").concat(new URLSearchParams(window.location.search).get("code")),{withCredentials:!0});case 5:this.checkAndRedirect(),this.props.finishPendingRequest(t),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),this.props.addFlashMessage({type:v.ERROR,text:"Error Authenticating",id:Object(M.a)()}),this.props.finishPendingRequest(t);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"checkAndRedirect",value:function(){var e=Object(q.a)(P.a.mark((function e(){var t,n;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.isAuthenticated){e.next=3;break}return e.abrupt("return");case 3:return t=Object(M.a)(),e.prev=4,this.props.addPendingRequest({id:t,message:"Fetching Profile",type:E.PROFILE}),e.next=8,L.a.post("".concat(w,"/spotify-request"),{spotify_path:"https://api.spotify.com/v1/me",spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":_}});case 8:if(n=e.sent,this.props.finishPendingRequest(t),!n.data||!n.data.id){e.next=16;break}return this.props.authenticate(n.data.id),d.a.set({userId:n.data.id}),localStorage.setItem("logged_in_tonalify",n.data.display_name),this.setState({displayName:n.data.display_name}),e.abrupt("return");case 16:a&&this.props.history.push("/home"),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(4),this.props.finishPendingRequest(t);case 22:case"end":return e.stop()}}),e,this,[[4,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var a=this;return this.props.requireAuth?this.props.isAuthenticated?s.a.createElement(e,Object.assign({},(this.props,t),{displayName:this.state.displayName,login:function(){return a.login()}})):null:s.a.createElement(e,Object.assign({},(this.props,t),{login:function(){return a.login()}}))}}]),l}(s.a.Component);return Object(o.compose)(i.f,Object(c.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{authenticate:function(t){return e({type:"AUTHENTICATE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})},addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})}}})))(n)},ve=function(e,t,a,n){return e===t?s.a.createElement("th",{onClick:function(e){return n(e)}},e,0!==a&&a?null:s.a.createElement(s.a.Fragment,null,"\u2191\u2193"),1===a?s.a.createElement(s.a.Fragment,null,"\u2191"):null,2===a?s.a.createElement(s.a.Fragment,null,"\u2193"):null):s.a.createElement("th",{onClick:function(e){n(e)}},e,"\u2191\u2193")},ke=function(e){Object(A.a)(a,e);var t=Object(x.a)(a);function a(e){var n;Object(S.a)(this,a),n=t.call(this,e);var s=localStorage.getItem("tonalify_selection"),r=JSON.parse(s).map((function(e){return Object(f.a)({},e,{albumName:e.album&&e.album.name?e.album.name:""})}));return n.state={trackList:[],filtered:!1,key:null,mode:null,sort:{column:null,direction:null},errorFetching:!1,disableTable:!1,query:"",trackSelection:r||[],modalActive:!1,trackToAnalyze:{}},V(),n}return Object(N.a)(a,[{key:"filterByKey",value:function(e){"key"!==e.target.name?"mode"===e.target.name&&this.setState({mode:e.target.value,filtered:!!e.target.value||!!this.state.key}):this.setState({key:e.target.value,filtered:!!e.target.value||!!this.state.mode})}},{key:"getFilteredTracks",value:function(){var e=this,t=this.state,a=t.key,n=t.mode,s=Object(p.a)(this.state.trackSelection).filter((function(e){return a&&n&&e.key===a&&e.mode===n||a&&!n&&e.key===a||!a&&n&&e.mode===n?e:a||n?void 0:e}));return this.state.query?s.filter((function(t){var a=t.name,n=t.artist,s=t.tempo,r=t.mode,l=t.key,i=!1;if([a,n,s,r,l].map((function(t){t&&t.toString().toLowerCase().includes(e.state.query.toLocaleLowerCase())&&(i=!0)})),i)return t})):s}},{key:"search",value:function(e){e.target.value&&e.target.value.length?this.setState({query:e.target.value,filtered:!0}):this.setState({query:"",filtered:!1})}},{key:"removeFromSelection",value:function(e){var t=localStorage.getItem("tonalify_selection"),a=(JSON.parse(t)?JSON.parse(t):[]).filter((function(t){return t.id!==e.id}));localStorage.setItem("tonalify_selection",JSON.stringify(a)),this.setState({trackSelection:a})}},{key:"addToSelection",value:function(e){var t=localStorage.getItem("tonalify_selection"),a=JSON.parse(t)?JSON.parse(t):[],n=[].concat(Object(p.a)(a),[e]);localStorage.setItem("tonalify_selection",JSON.stringify(n)),this.setState({trackSelection:n})}},{key:"refreshSelection",value:function(){var e=localStorage.getItem("tonalify_selection"),t=JSON.parse(e);this.setState({trackSelection:t})}},{key:"exportSelection",value:function(){var e=Object(q.a)(P.a.mark((function e(t){var a,n,s,r,l,i,c;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=Object(M.a)(),n=Object(M.a)(),s=t.target.playlist_name.value,r=t.target.playlist_description.value,e.prev=5,this.props.addPendingRequest({id:a,type:E.USER_LIBRARY,message:"Creating New Playlist"}),e.next=9,L.a.post("".concat(w,"/spotify-request"),{spotify_path:"https://api.spotify.com/v1/users/".concat(this.props.userId,"/playlists"),spotify_payload:{name:s,description:r},crud_operation:"post"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":_}});case 9:if(l=e.sent,this.props.finishPendingRequest(a),l&&l.data&&l.data.id){e.next=13;break}return e.abrupt("return");case 13:return this.props.addPendingRequest({id:n,type:E.USER_LIBRARY,message:"Adding Tracks To Playlist"}),i=this.state.filtered?this.getFilteredTracks():this.state.trackSelection,e.next=17,L.a.post("".concat(w,"/spotify-request"),{spotify_path:"https://api.spotify.com/v1/playlists/".concat(l.data.id,"/tracks"),spotify_payload:{uris:i.map((function(e){return e.uri}))},crud_operation:"post"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":_}});case 17:if((c=e.sent)&&c.data&&c.data.snapshot_id){e.next=20;break}return e.abrupt("return");case 20:this.props.finishPendingRequest(n),this.props.addFlashMessage({type:v.SUCCESS,text:"Created ".concat(s),id:Object(M.a)()}),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(5),this.props.finishPendingRequest(n),this.props.finishPendingRequest(a),this.props.addFlashMessage({type:v.ERROR,text:"Error Creating Playlist",id:Object(M.a)()});case 29:case"end":return e.stop()}}),e,this,[[5,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"sortColumn",value:function(e){var t=1;if(this.state.sort.column!==e)t=1;else switch(this.state.sort.direction){case 0:t=1;break;case 1:t=2;break;case 2:t=0}this.setState({sort:{column:e,direction:t}})}},{key:"getSortedTracks",value:function(e){var t=this.state.sort,a=t.direction,n=t.column;return Object(p.a)(e).sort((function(e,t){return 1===a?e[n]>t[n]?1:-1:2===a?e[n]<t[n]?1:-1:1}))}},{key:"closeModal",value:function(){this.setState({modalActive:!1})}},{key:"render",value:function(){var e=this,t=this.state.filtered?this.getFilteredTracks():this.state.trackSelection,a=this.getSortedTracks(t),n=this.state,r=n.trackToAnalyze,l=n.trackSelection,i=this.props.isAuthenticated;return s.a.createElement("div",{className:"user-selection-wrapper"},this.state.modalActive?s.a.createElement(ce,{track:r,searchResults:!i,addToSelection:function(t){return e.addToSelection(t)},removeFromSelection:function(t){return e.removeFromSelection(t)},refreshSelection:function(){return e.refreshSelection()},closeModal:function(){return e.closeModal()},trackSelection:l}):null,this.state.errorFetching?s.a.createElement("p",{className:"notification is-danger"},"Error Loading Track Selection, Refresh the Page"):s.a.createElement(s.a.Fragment,null,i?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container has-text-centered is-widescreen"},s.a.createElement("p",{className:"title"},"Export To Spotify"),s.a.createElement("p",null,"Modify and export your current selection or return to your"," ",s.a.createElement(D.a,{to:"/your-playlists"},"Playlists")," and"," ",s.a.createElement(D.a,{to:"/your-albums"},"Albums")," to continue adding tracks"))),s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"columns is-centered"},s.a.createElement("div",{className:"form-wrapper box column is-half"},s.a.createElement("div",{className:"has-text-centered"},s.a.createElement("p",null,"Export Playlist")),s.a.createElement("form",{id:"playlist-form",className:"create-playlist-form",onSubmit:function(t){return e.exportSelection(t)}},s.a.createElement("div",{className:"playlist-inputs"},s.a.createElement("div",{className:"field"},s.a.createElement("label",{htmlFor:"name",className:"label"},"Name"),s.a.createElement("input",{id:"name",className:"input",name:"playlist_name",placeholder:"Playlist Name"})),s.a.createElement("div",{className:"field"},s.a.createElement("label",{htmlFor:"description",className:"label"},"Description"),s.a.createElement("textarea",{id:"description",rows:2,className:"playlist-description textarea",name:"playlist_description",placeholder:"Playlist Description"}))),s.a.createElement("div",{className:"export-button-wrapper"},s.a.createElement("button",{className:"export-button button is-primary"},"Create"))))))):s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container has-text-centered is-widescreen"},s.a.createElement("p",{className:"title"},"Export To Spotify"),s.a.createElement("p",null,s.a.createElement("a",{href:"",onClick:function(){return e.props.login()}},"Login")," ","to Export your selection to a spotify playlist. The selection will still be here after logging in"))),s.a.createElement("div",{className:"table-section-wrapper"},s.a.createElement("div",{className:"table-wrapper"},this.state.disableTable?s.a.createElement("div",{className:"table-ajax-cover"},s.a.createElement("div",{className:"ajax-spinner"},s.a.createElement("div",{className:"spinner"}))):null,s.a.createElement("div",{className:"table-controls-wrapper"},s.a.createElement("div",{className:"key-and-mode-filter-wrapper"},s.a.createElement("form",{onChange:function(t){e.filterByKey(t)}},s.a.createElement("div",{className:"filter-wrapper"},s.a.createElement("div",{className:"select"},s.a.createElement("select",{name:"key"},s.a.createElement("option",{selected:!this.state.key,disabled:!0,value:""},"Key"),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map((function(e){return s.a.createElement("option",{key:Object(M.a)(),value:e},e)})))),this.state.key?s.a.createElement("button",{onClick:function(t){return e.setState({key:null})}},s.a.createElement($.a,{className:"has-text-link"})):null),s.a.createElement("div",{className:"filter-wrapper"},s.a.createElement("div",{className:"select"},s.a.createElement("select",{name:"mode"},s.a.createElement("option",{selected:!this.state.mode,disabled:!0,value:""},"mode"),s.a.createElement("option",{value:"major"},"major"),s.a.createElement("option",{value:"minor"},"minor"))),this.state.mode?s.a.createElement("button",{onClick:function(t){return e.setState({mode:null})}},s.a.createElement($.a,{className:"has-text-link"})):null))),s.a.createElement("div",{className:"search-input-wrapper field"},s.a.createElement("input",{className:"input is-small",onChange:function(t){return e.search(t)},placeholder:"Search",value:this.state.query}),this.state.query.length?s.a.createElement("button",{onClick:function(){e.setState({query:""})}},s.a.createElement($.a,{className:"has-text-link"})):null," ")),s.a.createElement("table",{className:"table is-bordered is-striped "},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"deselect"),ve("name",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("name")})),ve("key",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("key")})),ve("mode",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("mode")})),ve("tempo",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("tempo")})),ve("artist",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("artist")})),ve("album",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("albumName")})))),s.a.createElement("tbody",null,a.map((function(t){return s.a.createElement("tr",{key:Object(M.a)()},s.a.createElement("td",{align:"center"},s.a.createElement(X.a,{className:"selection-button-icon has-text-link ".concat(e.state.disableTable?"disabled-icon":""),onClick:function(){e.removeFromSelection(t)}})),s.a.createElement("td",null,s.a.createElement("a",{onClick:function(){e.setState({trackToAnalyze:t,modalActive:!0})}},t.name)),s.a.createElement("td",null,t.altKey?t.altKey:t.key),s.a.createElement("td",null,t.altMode?t.altMode:t.mode),s.a.createElement("td",null,t.altTempo?t.altTempo:Number(t.tempo).toFixed(2)),s.a.createElement("td",null,t.artist),s.a.createElement("td",null,t.albumName))}))))))))}}]),a}(n.Component);var Se=Object(c.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated,userId:e.auth.id}}),(function(e){return{addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}}))(ke),Ne=function(e){Object(A.a)(a,e);var t=Object(x.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={},n}return Object(N.a)(a,[{key:"render",value:function(){var e=this.props.requests,t=e[e.length-1];return t?s.a.createElement("div",{className:"spinner-wrapper"},s.a.createElement("div",{className:"spinner-content"},s.a.createElement("div",null,s.a.createElement("div",{className:"spinner"})),t?s.a.createElement("p",null,t.message):null)):null}}]),a}(n.Component),Ae=Object(c.b)((function(e){return{requests:e.ajax.requests}}),(function(e){return{}}))(Ne),xe=a(16);V();var we=Object(o.createStore)(Object(o.combineReducers)(k),Object(m.composeWithDevTools)(Object(o.applyMiddleware)(u.a)));d.a.initialize("G-GSGF6DMM8Z");var _e=Object(xe.a)();_e.listen((function(e){d.a.set({page:e.pathname}),d.a.pageview(e.pathname)}));var Te=function(){return s.a.createElement(c.a,{store:we},s.a.createElement(i.b,{history:_e},s.a.createElement("div",null,s.a.createElement(Ae,null),s.a.createElement(j,null),s.a.createElement(z,null),s.a.createElement(i.c,null,s.a.createElement(i.a,{path:"/search",component:Ee(he)}),s.a.createElement(i.a,{path:"/your-playlists",component:Ee(be,{type:"PLAYLISTS"},!0)}),s.a.createElement(i.a,{path:"/your-albums",component:Ee(be,{type:"ALBUMS"},!0)}),s.a.createElement(i.a,{path:"/tracks",component:Ee(de)}),s.a.createElement(i.a,{path:"/selection",component:Ee(Se)}),s.a.createElement(i.a,{path:"/",component:Ee(ye)})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(s.a.createElement(Te,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[57,1,2]]]);
//# sourceMappingURL=main.5f04c990.chunk.js.map