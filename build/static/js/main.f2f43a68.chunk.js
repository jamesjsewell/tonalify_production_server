(this.webpackJsonpspotify_app_frontend=this.webpackJsonpspotify_app_frontend||[]).push([[0],{49:function(e,t,a){e.exports=a.p+"static/media/tonalify.8482fd0a.svg"},54:function(e,t,a){e.exports=a(88)},59:function(e,t,a){},60:function(e,t,a){},61:function(e,t,a){},88:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(30),i=a.n(r),c=(a(59),a(60),a(61),a(7)),l=a(13),o=a(6),u=a(14),d=a(47),p=a(48),m=(a(66),a(4)),h=[];var f=a(19),y={isAuthenticated:!1,id:null};var g=[];var E={isLoading:!1,requests:[]};var b,v,k={trackSelection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_SELECTION":return Object(m.a)(t.payload);default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"AUTHENTICATE":return Object(f.a)({},e,{isAuthenticated:!0,id:t.payload});case"DEAUTHENTICATE":return Object(f.a)({},e,{isAuthenticated:!1,id:null});default:return e}},flashMessages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_FLASH_MESSAGE":return[].concat(Object(m.a)(e),[t.payload]);case"DELETE_FLASH_MESSAGE":return Object(m.a)(e).filter((function(e){return e.id!=t.payload}));default:return e}},ajax:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_PENDING_REQUEST":return Object(f.a)({},e,{requests:[].concat(Object(m.a)(e.requests),[t.payload])});case"FINISH_PENDING_REQUEST":return Object(f.a)({},e,{requests:Object(m.a)(e.requests).filter((function(e){return!!e.id===t.payload}))});case"IS_LOADING":return Object(f.a)({},e,{isLoading:t.payload});default:return e}}},S=a(8),N=a(9),A=a(11),R=a(10),w="https://yfitops.herokuapp.com",x="https://tonalify.herokuapp.com";!function(e){e[e.PROFILE=0]="PROFILE",e[e.USER_LIBRARY=1]="USER_LIBRARY"}(b||(b={})),function(e){e[e.ERROR=0]="ERROR",e[e.SUCCESS=1]="SUCCESS"}(v||(v={}));var O={0:"C",1:"C#",2:"D",3:"D#",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"A#",11:"B"},C={0:"minor",1:"major"},T={3:"3/4",4:"4/4",5:"5/4",6:"6/4",7:"7/4"},j=function(e){Object(A.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={message:null},n}return Object(N.a)(a,[{key:"componentDidUpdate",value:function(e){var t=e.flashMessages[e.flashMessages.length-1],a=this.props.flashMessages[this.props.flashMessages.length-1];(a&&t&&a.id!==t.id||!t&&a)&&this.renderFlashMessage()}},{key:"renderFlashMessage",value:function(){var e=this,t=this.props.flashMessages[this.props.flashMessages.length-1];t&&setTimeout((function(){e.props.deleteFlashMessage(t.id)}),5e3)}},{key:"render",value:function(){var e=this.props.flashMessages,t=e[e.length-1];return s.a.createElement("div",{className:"flash-messages-wrapper"},t?s.a.createElement("div",{className:"flash-message-content"},t.type===v.SUCCESS?s.a.createElement("div",{className:"notification is-success"},t.text):null,t.type===v.ERROR?s.a.createElement("div",{className:"notification is-danger"},t.text):null):null)}}]),a}(n.Component),_=Object(o.b)((function(e){return{flashMessages:e.flashMessages}}),(function(e){return{deleteFlashMessage:function(t){return e({type:"DELETE_FLASH_MESSAGE",payload:t})}}}))(j),P=a(2),I=a.n(P),q=a(5),F=a(3),D=a.n(F),L=a(99),U=a(49),M=a.n(U),B=function(e){Object(A.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={mobile:!1},n}return Object(N.a)(a,[{key:"logout",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(L.a)(),this.props.addPendingRequest({id:t,type:b.PROFILE,message:"Logging Out"}),e.next=4,D.a.get("".concat(w,"/logout"),{withCredentials:!0});case 4:if(a=e.sent,this.props.finishPendingRequest(t),a&&a.data){e.next=8;break}return e.abrupt("return");case 8:this.props.deauthenticate();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(L.a)(),e.prev=1,this.props.addPendingRequest({id:t,type:b.PROFILE,message:"Logging In"}),e.next=5,D.a.get("".concat(w,"/login"));case 5:if(a=e.sent,this.props.finishPendingRequest(t),!a||!a.data){e.next=10;break}return window.location.href=a.data,e.abrupt("return");case 10:this.props.addFlashMessage({type:v.ERROR,text:"Error Fetching Login URL",id:Object(L.a)()}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),this.props.finishPendingRequest(t),this.props.addFlashMessage({type:v.ERROR,text:"Error Fetching Login URL",id:Object(L.a)()});case 17:case"end":return e.stop()}}),e,this,[[1,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"clickHamburger",value:function(){this.setState({mobile:!this.state.mobile})}},{key:"render",value:function(){var e=this,t=this.props.isAuthenticated;return s.a.createElement("nav",{className:"navbar-wrapper navbar is-spaced"},s.a.createElement("div",{className:"navbar-brand"},s.a.createElement(c.b,{className:"navbar-tonalify-link navbar-item is-family-sans-serif has-text-primary has-text-weight-bold",to:"/home"},s.a.createElement("img",{src:M.a})),s.a.createElement("a",{role:"button",className:"navbar-burger burger ".concat(this.state.mobile?"is-active":""),"aria-label":"menu","data-target":"nav-menu",onClick:function(t){return e.clickHamburger()}},s.a.createElement("span",{"aria-hidden":"true"}),s.a.createElement("span",{"aria-hidden":"true"}),s.a.createElement("span",{"aria-hidden":"true"}))),s.a.createElement("div",{id:"nav-menu",className:"navbar-menu ".concat(this.state.mobile?"is-active":"")},s.a.createElement("div",{className:"navbar-start"},s.a.createElement(c.b,{className:"navbar-item",to:"/home",activeClassName:"is-active"},"Home"),t?s.a.createElement(n.Fragment,null,s.a.createElement(c.b,{className:"navbar-item",to:"/search",activeClassName:"is-active"},"Search"),s.a.createElement(c.b,{className:"navbar-item",to:"/your-playlists",activeClassName:"is-active"},"Playlists"),s.a.createElement(c.b,{className:"navbar-item",to:"/your-albums",activeClassName:"is-active"},"Albums")):null,s.a.createElement(c.b,{className:"navbar-item",to:"/selection",activeClassName:"is-active"},"Export")),s.a.createElement("div",{className:"navbar-end"},s.a.createElement("div",{className:"navbar-item"},s.a.createElement("div",{className:"buttons"},this.props.isAuthenticated?s.a.createElement("a",{className:"button is-light",onClick:function(){return e.logout()}},"Logout"):s.a.createElement("a",{className:"button is-light",onClick:function(){return e.login()}},"Login"))))))}}]),a}(n.Component);var G=Object(o.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{deauthenticate:function(){return e({type:"DEAUTHENTICATE"})},addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}}))(B),H=a(52),Y=a.n(H),Q=a(31),z=a.n(Q),J=a(25),K=a.n(J),W=a(21),X=a.n(W),$=a(35),V=function(e){return e.dispatchEvent(new CustomEvent("enableBodyScroll",{bubbles:!0}))},Z=function(e){return e.dispatchEvent(new CustomEvent("disableBodyScroll",{bubbles:!0}))},ee=function(){var e="hidden"==document.body.style.overflow;document.documentElement.style.overflowY=e?"hidden":"scroll"};document.addEventListener("enableBodyScroll",(function(e){var t=e.target;$.b(t),setTimeout(ee,0)})),document.addEventListener("disableBodyScroll",(function(e){var t=e.target;$.a(t),setTimeout(ee,0)}));var te=function(e){function t(e,t,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?e+6*(t-e)*a:a<.5?t:a<2/3?e+(t-e)*(2/3-a)*6:e}var a=function(e,a,n){var s,r,i;if(0==a)s=r=i=n;else{var c=n<.5?n*(1+a):n+a-n*a,l=2*n-c;s=t(l,c,e+1/3),r=t(l,c,e),i=t(l,c,e-1/3)}return[Math.floor(255*s),Math.floor(255*r),Math.floor(255*i)]}(1.2*(e*=100)/360,1,.5);return a[0]+","+a[1]+","+a[2]},ae=function(e,t,a,n,r,i,c){return s.a.createElement("div",{className:"modal is-active"},s.a.createElement("div",{className:"modal-background",onClick:function(){e()}}),s.a.createElement("div",{id:"modal-content",className:"modal-content has-background-light"},!t&&a?s.a.createElement("div",{style:{position:"absolute",top:"0",left:"50%",transform:"translateX(-50%)",width:"100%",height:"20px",background:"linear-gradient(to right,rgb(255,0,0)0%,rgb(255,255,0) 50%,rgb(0,255,0) 100%)",display:"inline-flex",justifyContent:"space-between",alignItems:"center",padding:"2px"}},s.a.createElement("p",null,"0%"),s.a.createElement("p",null,"analysis confidence"),s.a.createElement("p",null,"100%")):null,!t&&a&&a.track?s.a.createElement("div",{className:"track-analysis-content"},s.a.createElement("div",{style:{marginTop:"20px",display:"inline-flex",justifyContent:"space-between",width:"100%"}},s.a.createElement("p",null,n.name),r.find((function(e){return e.id===n.id}))?s.a.createElement("div",{className:"has-text-link",style:{display:"inline-flex",justifyContent:"space-between",cursor:"pointer"},onClick:function(){c(n)}},"deselect",s.a.createElement(K.a,{className:"selection-button-icon"})):s.a.createElement("div",{className:"has-text-link",style:{display:"inline-flex",justifyContent:"space-between",cursor:"pointer"},onClick:function(){i(n)}},"select",s.a.createElement(z.a,{className:"selection-button-icon"}))),s.a.createElement("div",{style:{display:"flex",width:"100%",justifyContent:"center"}},s.a.createElement("div",{className:"confidence-bar",style:{backgroundColor:"rgb(".concat(te(a.track.key_confidence),")")}},s.a.createElement("p",null,O[a.track.key])),s.a.createElement("div",{className:"confidence-bar",style:{backgroundColor:"rgb(".concat(te(a.track.mode_confidence),")")}},s.a.createElement("p",null,C[a.track.mode])),s.a.createElement("div",{className:"confidence-bar",style:{overflow:"visible !important",backgroundColor:"rgb(".concat(te(a.track.tempo_confidence),")")}},s.a.createElement("p",null,a.track.tempo.toFixed(2))),s.a.createElement("div",{className:"confidence-bar",style:{backgroundColor:"rgb(".concat(te(a.track.time_signature_confidence))}},s.a.createElement("p",null,T[a.track.time_signature]))),s.a.createElement("div",{className:"table-wrapper card"},s.a.createElement("table",{className:"table is-bordered is-striped"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"section"),s.a.createElement("th",null,"start"),s.a.createElement("th",null,"duration"),s.a.createElement("th",null,"key"),s.a.createElement("th",null,"mode"),s.a.createElement("th",null,"tempo"),s.a.createElement("th",null,"meter"))),s.a.createElement("tbody",null,a.sections.map((function(e,t){return s.a.createElement("tr",{key:Object(L.a)(),style:{background:"rgba(".concat(te(e.confidence),",0.3)"),boxShadow:"0px 0px 0px 5px rgb(".concat(te(e.confidence),") inset")}},s.a.createElement("td",null,t+1),s.a.createElement("td",null,new Date(1e3*e.start).toISOString().substr(11,8)),s.a.createElement("td",null,new Date(1e3*e.duration).toISOString().substr(11,8)),s.a.createElement("td",{style:{backgroundColor:"rgb(".concat(te(e.key_confidence))}},O[e.key]),s.a.createElement("td",{style:{backgroundColor:"rgb(".concat(te(e.mode_confidence))}},C[e.mode]),s.a.createElement("td",{style:{backgroundColor:"rgb(".concat(te(e.tempo_confidence))}},e.tempo.toFixed(2)),s.a.createElement("td",{style:{backgroundColor:"rgb(".concat(te(e.time_signature_confidence))}},T[e.time_signature]))})))))):null),s.a.createElement("button",{className:"modal-close is-large","aria-label":"close",onClick:function(){e()}}))};function ne(){try{localStorage.setItem("test","test"),localStorage.removeItem("test")}catch(e){if("QUATA_EXCEEDED_ERR"===e.name||"NS_ERROR_DOM_QUATA_REACHED"===e.name)return void alert("local storage is full, clear cache to continue");try{if(0===localStorage.remainingSpace)return void alert("local storage is full, clear cache to continue")}catch(e){}return void alert("local storage is required to continue")}}var se=function(e,t,a,n){return e===t?s.a.createElement("th",{onClick:function(e){return n(e)}},e,0!==a&&a?null:s.a.createElement(s.a.Fragment,null,"\u2191\u2193"),1===a?s.a.createElement(s.a.Fragment,null,"\u2191"):null,2===a?s.a.createElement(s.a.Fragment,null,"\u2193"):null):s.a.createElement("th",{onClick:function(e){n(e)}},e,"\u2191\u2193")},re=function(e){Object(A.a)(a,e);var t=Object(R.a)(a);function a(e){var n;Object(S.a)(this,a),n=t.call(this,e);var s=localStorage.getItem("tonalify_selection"),r=JSON.parse(s);return n.state={trackList:[],spotifyPath:localStorage.getItem("spotify_path"),filtered:!1,key:null,mode:null,sort:{column:null,direction:null},errorFetchingTracks:!1,disableTable:!1,query:"",trackSelection:r||[],modalActive:!1,fetchingAnalysis:!1,trackAnalysis:{},trackToAnalyze:{},next:!1},ne(),n.getTracks(),n}return Object(N.a)(a,[{key:"getAnalysis",value:function(){var e=Object(q.a)(I.a.mark((function e(t){var a,n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(L.a)(),this.props.addPendingRequest({id:a,type:b.USER_LIBRARY,message:"Fetching Audio Details"}),this.setState({fetchingAnalysis:!0,modalActive:!0,trackToAnalyze:t},(function(){Z(document.querySelector("#modal-content"))})),e.next=5,D.a.post("".concat(w,"/").concat(this.props.searchResults?"spotify-search":"spotify-request"),{spotify_path:"https://api.spotify.com/v1/audio-analysis/".concat(t.id),spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 5:n=e.sent,this.props.finishPendingRequest(a),this.setState({trackAnalysis:n.data,fetchingAnalysis:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTracks",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a,n,s,r,i,c,l,o,u,d;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(L.a)(),a=Object(L.a)(),e.prev=2,this.props.addPendingRequest({id:t,type:b.USER_LIBRARY,message:"Fetching Tracks"}),e.next=6,D.a.post("".concat(w,"/").concat(this.props.searchResults?"spotify-search":"spotify-request"),{spotify_path:this.state.spotifyPath,spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 6:if(n=e.sent,this.props.finishPendingRequest(t),n.data){e.next=10;break}return e.abrupt("return");case 10:return s=n.data,r=s.next,i=s.items,(c=s.tracks)&&c.items&&(r=c.next),l=i||c,l=c&&c.items?c.items:l,this.props.addPendingRequest({id:a,type:b.USER_LIBRARY,message:"Fetching Audio Details"}),e.next=17,D.a.post("".concat(w,"/").concat(this.props.searchResults?"spotify-search":"spotify-request"),{spotify_path:"https://api.spotify.com/v1/audio-features?ids=".concat(l.map((function(e){return e.track&&(e=e.track),e.id}))),spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 17:o=e.sent,this.props.finishPendingRequest(a),u=[],o&&o.data&&o.data.audio_features&&(u=o.data.audio_features),d=Object(m.a)(this.state.trackList).concat(l.map((function(e){e.track&&(e=e.track);var t=u.find((function(t){return t&&e&&t.id===e.id}));return Object(f.a)({},e,{selected:!1,tempo:t?t.tempo:null,key:t?O[t.key]:null,mode:t?C[t.mode]:null,artist:e.artists&&e.artists.length?e.artists[0].name:null})}))),this.setState(Object(f.a)({},this.state,{trackList:d,spotifyPath:r,next:!(!r||!r.length),errorFetchingTracks:!1}),(function(){})),e.next=30;break;case 25:e.prev=25,e.t0=e.catch(2),this.props.finishPendingRequest(t),this.props.finishPendingRequest(a),this.setState(Object(f.a)({},this.state,{errorFetchingTracks:!0}));case 30:case"end":return e.stop()}}),e,this,[[2,25]])})));return function(){return e.apply(this,arguments)}}()},{key:"filterByKey",value:function(e){"key"!==e.target.name?"mode"===e.target.name&&this.setState({mode:e.target.value,filtered:!!e.target.value||!!this.state.key}):this.setState({key:e.target.value,filtered:!!e.target.value||!!this.state.mode})}},{key:"search",value:function(e){e.target.value&&e.target.value.length?this.setState({query:e.target.value,filtered:!0}):this.setState({query:"",filtered:!1})}},{key:"getFilteredTracks",value:function(){var e=this,t=this.state,a=t.key,n=t.mode,s=Object(m.a)(this.state.trackList).filter((function(e){return a&&n&&e.key===a&&e.mode===n||a&&!n&&e.key===a||!a&&n&&e.mode===n?e:a||n?void 0:e}));return this.state.query?s.filter((function(t){var a=t.name,n=t.artist,s=t.tempo,r=t.mode,i=t.key,c=!1;if([a,n,s,r,i].map((function(t){t&&t.toString().toLowerCase().includes(e.state.query.toLocaleLowerCase())&&(c=!0)})),c)return t})):s}},{key:"addToSelection",value:function(e){var t=localStorage.getItem("tonalify_selection"),a=JSON.parse(t)?JSON.parse(t):[],n=[].concat(Object(m.a)(a),[e]);localStorage.setItem("tonalify_selection",JSON.stringify(n)),this.setState({trackSelection:n})}},{key:"removeFromSelection",value:function(e){var t=localStorage.getItem("tonalify_selection"),a=(JSON.parse(t)?JSON.parse(t):[]).filter((function(t){return t.id!==e.id}));localStorage.setItem("tonalify_selection",JSON.stringify(a)),this.setState({trackSelection:a})}},{key:"sortColumn",value:function(e){var t=1;if(this.state.sort.column!==e)t=1;else switch(this.state.sort.direction){case 0:t=1;break;case 1:t=2;break;case 2:t=0}this.setState({sort:{column:e,direction:t}})}},{key:"getSortedTracks",value:function(e){var t=this.state.sort,a=t.direction,n=t.column;return Object(m.a)(e).sort((function(e,t){return 1===a?e[n]>t[n]?1:-1:2===a?e[n]<t[n]?1:-1:1}))}},{key:"render",value:function(){var e=this,t=this.state.filtered?this.getFilteredTracks():this.state.trackList,a=this.getSortedTracks(t),n=localStorage.getItem("spotify_item_title"),r=this.state,i=r.fetchingAnalysis,l=r.trackAnalysis,o=r.trackToAnalyze,u=r.trackSelection,d=r.next;this.props.isAuthenticated;return s.a.createElement("div",{className:"tracks-view-wrapper"},this.state.modalActive?ae((function(){V(document.querySelector("#modal-content")),e.setState({modalActive:!1})}),i,l,o,u,(function(t){return e.addToSelection(t)}),(function(t){return e.removeFromSelection(t)})):null,this.state.errorFetchingTracks?s.a.createElement("p",{className:"notification is-danger"},"Error Loading Tracks, Refresh the Page"):s.a.createElement("div",{className:"tracks-view-content"},s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container has-text-centered is-widescreen"},s.a.createElement("p",{className:"title"},n),s.a.createElement("p",null,"This won't modify ",n," or your library, selecting and deselecting tracks only modifies your selection of tracks in this app. Use the table below to select and deselect tracks."," ",s.a.createElement(c.b,{to:"/selection"},"Export")," to modify and export your full selection of tracks, or continue to"," ",s.a.createElement(c.b,{to:"/your-playlists"},"Playlists")," and"," ",s.a.createElement(c.b,{to:"/your-albums"},"Albums")," to continue adding tracks"," "))),s.a.createElement("div",{className:"table-section-wrapper"},s.a.createElement("div",{className:"table-wrapper"},this.state.disableTable?s.a.createElement("div",{className:"table-ajax-cover"},s.a.createElement("div",{className:"ajax-spinner"},s.a.createElement("div",{className:"spinner"}))):null,s.a.createElement("div",{className:"table-controls-wrapper"},s.a.createElement("div",{className:"key-and-mode-filter-wrapper"},s.a.createElement("form",{onChange:function(t){e.filterByKey(t)}},s.a.createElement("div",{className:"filter-wrapper"},s.a.createElement("div",{className:"select"},s.a.createElement("select",{name:"key"},s.a.createElement("option",{selected:!this.state.key,disabled:!0,value:""},"Key"),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map((function(e){return s.a.createElement("option",{key:Object(L.a)(),value:e},e)})))),this.state.key?s.a.createElement("button",{onClick:function(t){return e.setState({key:null})}},s.a.createElement(X.a,{className:"has-text-link"})):null),s.a.createElement("div",{className:"filter-wrapper"},s.a.createElement("div",{className:"select"},s.a.createElement("select",{name:"mode"},s.a.createElement("option",{selected:!this.state.mode,disabled:!0,value:""},"mode"),s.a.createElement("option",{value:"major"},"major"),s.a.createElement("option",{value:"minor"},"minor"))),this.state.mode?s.a.createElement("button",{onClick:function(t){return e.setState({mode:null})}},s.a.createElement(X.a,{className:"has-text-link"})):null))),s.a.createElement("div",{className:"search-input-wrapper"},s.a.createElement("input",{className:"input is-small",onChange:function(t){return e.search(t)},placeholder:"Search",value:this.state.query}),this.state.query.length?s.a.createElement("button",{onClick:function(){e.setState({query:""})}},s.a.createElement(X.a,{className:"has-text-link"})):null)),s.a.createElement("table",{className:"table is-bordered is-striped"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"select"),se("name",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("name")})),se("key",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("key")})),se("mode",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("mode")})),se("tempo",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("tempo")})),se("artist",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("artist")})))),s.a.createElement("tbody",null,a.map((function(t){return s.a.createElement("tr",{key:Object(L.a)()},s.a.createElement("td",{align:"center"},e.state.trackSelection.find((function(e){return e&&t&&e.id===t.id}))?s.a.createElement(K.a,{className:"selection-button-icon has-text-link ".concat(e.state.disableTable?"disabled-icon":""),onClick:function(){e.removeFromSelection(t)}}):s.a.createElement(z.a,{className:"selection-button-icon has-text-link ".concat(e.state.disableTable?"disabled-icon":""),onClick:function(){e.addToSelection(t)}})),s.a.createElement("td",null,s.a.createElement("a",{onClick:function(){e.getAnalysis(t)}},t.name)),s.a.createElement("td",null,t.key),s.a.createElement("td",null,t.mode),s.a.createElement("td",null,Number(t.tempo).toFixed(2)),s.a.createElement("td",null,t.artist))})))),d?s.a.createElement("button",{onClick:function(){return e.getTracks()},className:"button"},"load more"):"end of results"))))}}]),a}(n.Component);var ie,ce=Object(o.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}}))(re);!function(e){e.ARTIST="ARTIST",e.TRACK="TRACK"}(ie||(ie={}));var le=function(e){Object(A.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={itemList:[],filtered:!1,sort:{column:null,direction:null},errorFetchingItems:!1,disableTable:!1,query:"",next:!1,searchBy:ie.TRACK,artists:[],artistsPath:"",nextArtists:"",albums:[],albumsPath:"",nextAlbums:"",selectedAlbum:null,showAlbumTracksTable:!1,showTracksTable:!1,showArtistAlbums:!0},ne(),n}return Object(N.a)(a,[{key:"search",value:function(e){var t=this;e.preventDefault();var a=this.state,n=a.searchBy,s=a.query;n===ie.TRACK&&(localStorage.setItem("spotify_path","https://api.spotify.com/v1/search?q=".concat(s,"&type=").concat(n.toLowerCase(),"&market=US")),localStorage.setItem("spotify_item_title",s),this.setState({showTracksTable:!1,showAlbumTracksTable:!1},(function(){t.setState({showTracksTable:!0})}))),n===ie.ARTIST&&this.setState({artists:[],nextArtists:"",albums:[]},(function(){t.getArtists()})),this.setState({filtered:!0})}},{key:"getArtists",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a,n,s,r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state,a=t.query,n=t.nextArtists,s=Object(L.a)(),this.props.addPendingRequest({id:s,type:b.USER_LIBRARY,message:"Fetching Artists"}),e.prev=3,e.next=6,D.a.post("".concat(w,"/spotify-search"),{spotify_path:n&&n.length?n:"https://api.spotify.com/v1/search?q=".concat(a,"&type=artist&market=US"),is_tracks:!1},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 6:if((r=e.sent)&&r.data&&r.data.artists){e.next=9;break}return e.abrupt("return");case 9:this.setState({artists:[].concat(Object(m.a)(this.state.artists),Object(m.a)(r.data.artists.items)),nextArtists:r.data.artists.next,showArtistAlbums:!0}),this.props.finishPendingRequest(s),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),this.props.finishPendingRequest(s);case 16:case"end":return e.stop()}}),e,this,[[3,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"getAlbums",value:function(){var e=Object(q.a)(I.a.mark((function e(t){var a,n,s;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.state.nextAlbums,n=Object(L.a)(),this.props.addPendingRequest({id:n,type:b.USER_LIBRARY,message:"Fetching Albums"}),e.prev=3,e.next=6,D.a.post("".concat(w,"/spotify-search"),{spotify_path:a&&a.length?a:"https://api.spotify.com/v1/artists/".concat(t,"/albums?market=US"),is_tracks:!1},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 6:if(s=e.sent,this.props.finishPendingRequest(n),s&&s.data){e.next=10;break}return e.abrupt("return");case 10:this.setState({albums:[].concat(Object(m.a)(this.state.albums),Object(m.a)(s.data.items)),nextAlbums:s.data.next}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),this.props.finishPendingRequest(n);case 16:case"end":return e.stop()}}),e,this,[[3,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.searchBy,n=t.artists,r=t.nextArtists,i=t.albums,c=t.nextAlbums,l=t.showAlbumTracksTable,o=t.showTracksTable,u=t.showArtistAlbums,d=this.props.isAuthenticated;return s.a.createElement("div",{className:"search-view-wrapper"},this.state.errorFetchingItems?s.a.createElement("p",{className:"notification is-danger"},"Error Loading Tracks, Refresh the Page"):s.a.createElement("div",{className:"search-view-content"},s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container has-text-centered playlists-and-albums-header"},s.a.createElement("p",{className:"title"},"Search Spotify"),s.a.createElement("p",null,"to get audio analysis of tracks"),d?null:s.a.createElement("span",null,s.a.createElement("a",{className:"",href:"",onClick:function(t){t.preventDefault(),e.props.login&&e.props.login()}},"Login")," ","with Spotify to access all features"))),s.a.createElement("div",{style:{display:"flex",alignContent:"center",flexDirection:"column",flexWrap:"wrap"}},s.a.createElement("div",{style:{display:"flex",justifyContent:"center",margin:"5px"}},s.a.createElement("button",{style:{margin:"2px"},className:"button is-outlined is-rounded ".concat(a===ie.ARTIST?"is-active":""),onClick:function(){e.setState({searchBy:ie.ARTIST,showAlbumTracksTable:!1,showTracksTable:!1})}},"artists"),s.a.createElement("button",{style:{margin:"2px"},className:"button is-outlined is-rounded ".concat(a===ie.TRACK?"is-active":""),onClick:function(){e.setState({searchBy:ie.TRACK,showAlbumTracksTable:!1,showTracksTable:!1})}},"tracks")),s.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},s.a.createElement("form",{style:{display:"inline-flex"}},s.a.createElement("input",{onChange:function(t){t.target.value&&t.target.value.length?e.setState({query:t.target.value}):e.setState({query:"",filtered:!1})},className:"input",placeholder:"search for ".concat(a.toLocaleLowerCase())}),s.a.createElement("button",{className:"button",type:"submit",onClick:function(t){e.search(t)}},s.a.createElement(Y.a,null))))),a===ie.ARTIST?s.a.createElement("div",{style:{marginTop:"20px"}},u?s.a.createElement("div",{className:""},a===ie.ARTIST&&n&&n.length?s.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},s.a.createElement("p",{style:{margin:"auto"}},"Select an Artist"),s.a.createElement("div",{style:{width:"100%",display:"inline-flex",overflowX:"scroll",justifyContent:"flex-start",margin:"10px"}},n.map((function(t){return s.a.createElement("button",{key:Object(L.a)(),className:"button",style:{flexShrink:0,color:"white",width:"auto",height:"100px",backgroundImage:'url("'.concat(t.images[2]?t.images[2].url:"",'")'),backgroundSize:"cover",backgroundPosition:"center",overflow:"hidden"},onClick:function(a){a.preventDefault(),e.setState({albums:[]},(function(){return e.getAlbums(t.id)}))}},s.a.createElement("p",{style:{color:"white",zIndex:5}},t.name),s.a.createElement("div",{style:{zIndex:1,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"100%",height:"100%",background:"rgba(0,0,0,.6)"}}))})),r?s.a.createElement("button",{className:"button",onClick:function(t){t.preventDefault(),e.getArtists()},style:{width:"auto",height:"100px",flexShrink:0}},"Load More"):null)):null,a===ie.ARTIST&&i&&i.length?s.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},s.a.createElement("p",{style:{margin:"auto"}},"Select an Album"),s.a.createElement("div",{style:{width:"100%",display:"inline-flex",overflowX:"scroll",justifyContent:"flex-start",margin:"10px"}},i.map((function(t){return s.a.createElement("button",{key:Object(L.a)(),className:"button",style:{flexShrink:0,color:"white",width:"auto",height:"100px",backgroundImage:'url("'.concat(t.images[2]?t.images[2].url:"",'")'),backgroundSize:"cover",backgroundPosition:"center",overflow:"hidden"},onClick:function(a){a.preventDefault(),e.setState({showTracksTable:!1,showAlbumTracksTable:!1,showArtistAlbums:!1},(function(){localStorage.setItem("spotify_path","https://api.spotify.com/v1/albums/".concat(t.id,"/tracks")),localStorage.setItem("spotify_item_title",t.name),e.setState({showAlbumTracksTable:!0,selectedAlbum:t},(function(){}))}))}},s.a.createElement("p",{style:{color:"white",zIndex:5}},t.name),s.a.createElement("div",{style:{zIndex:1,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"100%",height:"100%",background:"rgba(0,0,0,.6)"}}))})),c?s.a.createElement("button",{className:"button",onClick:function(t){t.preventDefault(),e.getAlbums("")},style:{width:"auto",height:"100px",flexShrink:0}},"Load More"):null)):null):s.a.createElement("div",{className:"card",style:{display:"flex",justifyContent:"center"}},s.a.createElement("button",{className:"button",onClick:function(){e.setState({showArtistAlbums:!0})}},"Expand Search Results"))):null,l?s.a.createElement(ce,{searchResults:!0}):null,o?s.a.createElement(ce,{searchResults:!0}):null))}}]),a}(n.Component);var oe=Object(u.compose)(l.f,Object(o.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}})))(le);D.a.defaults.withCredentials=!0;var ue=function(e){Object(A.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={displayName:""},ne(),n}return Object(N.a)(a,[{key:"componentDidMount",value:function(){this.props.isAuthenticated||(this.authenticateUser(),this.getProfile())}},{key:"authenticateUser",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(L.a)(),e.prev=1,!(a=new URLSearchParams(window.location.search).get("code"))){e.next=8;break}return this.props.addPendingRequest({id:t,type:b.PROFILE,message:"Authenticating"}),e.next=7,D.a.get("".concat(w,"/authorize?code=").concat(a),{withCredentials:!0});case 7:this.getProfile();case 8:this.props.finishPendingRequest(t),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),this.props.addFlashMessage({type:v.ERROR,text:"Error Authenticating",id:Object(L.a)()}),this.props.finishPendingRequest(t);case 15:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"getProfile",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(L.a)(),e.prev=1,this.props.addPendingRequest({id:t,type:b.PROFILE,message:"Fetching Profile"}),e.next=5,D.a.post("".concat(w,"/spotify-request"),{spotify_path:"https://api.spotify.com/v1/me",spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 5:if(a=e.sent,this.props.finishPendingRequest(t),!a.data||!a.data.id){e.next=12;break}return this.props.authenticate(a.data.id),this.props.addFlashMessage({type:v.SUCCESS,text:"Logged In!",id:Object(L.a)()}),this.setState({displayName:a.data.display_name}),e.abrupt("return");case 12:this.props.addFlashMessage({type:v.ERROR,text:"Error Fetching Profile",id:Object(L.a)()}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),this.props.addFlashMessage({type:v.ERROR,text:"Error Fetching Profile",id:Object(L.a)()}),this.props.finishPendingRequest(t);case 19:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(L.a)(),e.prev=1,this.props.addPendingRequest({id:t,type:b.PROFILE,message:"Logging In"}),e.next=5,D.a.get("".concat(w,"/login"));case 5:if(a=e.sent,this.props.finishPendingRequest(t),!a||!a.data){e.next=10;break}return window.location.href=a.data,e.abrupt("return");case 10:this.props.addFlashMessage({type:v.ERROR,text:"Error Fetching Login URL",id:Object(L.a)()}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),this.props.finishPendingRequest(t),this.props.addFlashMessage({type:v.ERROR,text:"Error Fetching Login URL",id:Object(L.a)()});case 17:case"end":return e.stop()}}),e,this,[[1,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.isAuthenticated,a=this.state.displayName;return s.a.createElement("div",{className:"home-view-wrapper"},t?s.a.createElement("div",{className:"section"},s.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},s.a.createElement("div",{className:"has-text-centered",style:{maxWidth:"400px",display:"flex",alignItems:"center",flexDirection:"column"}},s.a.createElement("p",{className:"title"},"Welcome, ",a)," ",s.a.createElement("p",null,"Browse your library and make track selections based on key or tempo, then export your selection as a Spotify playlist. This app won't modify your playlists, it will only add new playlists that you create"))),s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container is-widescreen has-text-centered"},s.a.createElement("div",{className:"links"},s.a.createElement(c.b,{className:"link-card has-background-primary has-text-white is-size-4",to:"/search"},s.a.createElement("p",null,"Search")),s.a.createElement(c.b,{className:"link-card has-background-primary has-text-white is-size-4",to:"/your-albums"},s.a.createElement("p",null,"Your Albums")),s.a.createElement(c.b,{className:"link-card has-background-primary has-text-white is-size-4",to:"/your-playlists"},s.a.createElement("p",null,"Your Playlists")),s.a.createElement(c.b,{className:"link-card has-background-primary has-text-white is-size-4",to:"/selection"},s.a.createElement("p",null,"Export Selection"))),s.a.createElement("hr",null),s.a.createElement("div",{className:"buy-me-coffee-wrapper"},s.a.createElement("a",{className:"bmc-button has-background-link",href:"https://www.buymeacoffee.com/tonalify"},s.a.createElement("img",{src:"https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg",alt:"Buy me a coffee"}),s.a.createElement("span",{style:{marginLeft:"5px",fontSize:"19px !important"}},"Buy me a coffee")))))):null,t?null:s.a.createElement(oe,{login:function(){return e.login()}}))}}]),a}(n.Component);var de=Object(o.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{authenticate:function(t){return e({type:"AUTHENTICATE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})},addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})}}}))(ue),pe=function(e){Object(A.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={collection:[],showTracks:!1,tracksPath:"",showTable:!1,selectedPlaylistPath:"",selectedPlaylistTitle:"",errorFetching:!1,query:"",spotifyPath:"PLAYLISTS"===n.props.type?"https://api.spotify.com/v1/me/playlists?limit=50":"https://api.spotify.com/v1/me/albums?limit=50",fetching:!1,collectionType:"PLAYLISTS"===n.props.type?"Playlist":"Album"},ne(),n}return Object(N.a)(a,[{key:"componentDidMount",value:function(){this.getPlaylists()}},{key:"getPlaylists",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a,n,s=this;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(L.a)(),e.prev=1,this.setState({fetching:!0}),this.props.addPendingRequest({id:t,type:b.USER_LIBRARY,message:"PLAYLISTS"===this.props.type?"Fetching Playlists":"Fetching Albums"}),e.next=6,D.a.post("".concat(w,"/spotify-request"),{spotify_path:this.state.spotifyPath,spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 6:if(a=e.sent,this.props.finishPendingRequest(t),a&&a.data&&a.data.items){e.next=10;break}return e.abrupt("return");case 10:n=a.data.next,this.setState({collection:Object(m.a)(this.state.collection).concat("PLAYLISTS"===this.props.type?a.data.items:a.data.items.map((function(e){return e.album}))),spotifyPath:n,fetching:!1},(function(){n&&s.getPlaylists()})),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),this.props.finishPendingRequest(t),this.setState({errorFetching:!0,fetching:!1});case 18:case"end":return e.stop()}}),e,this,[[1,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"open",value:function(e,t){localStorage.setItem("spotify_path","https://api.spotify.com/v1/".concat("PLAYLISTS"===this.props.type?"playlists":"albums","/").concat(e,"/tracks")),localStorage.setItem("spotify_item_title",t),this.props.history.push("/tracks")}},{key:"search",value:function(e){this.setState({query:e})}},{key:"filterCollection",value:function(){var e=this;return Object(m.a)(this.state.collection).filter((function(t){var a=t.description,n=t.name,s=e.state.query.toLocaleLowerCase();if(a&&a.toString().toLowerCase().includes(s)||n&&n.toString().toLowerCase().includes(s))return t}))}},{key:"render",value:function(){var e=this,t=this.state.query&&this.state.query.length?this.filterCollection():this.state.collection;return s.a.createElement("div",{className:"playlists-view-wrapper"},s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container has-text-centered playlists-and-albums-header"},s.a.createElement("p",{className:"title"},"Your ",this.state.collectionType,"s"),s.a.createElement("p",null,"Choose ",this.state.collectionType," to Select Tracks From"))),s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container is-widescreen"},s.a.createElement("div",{className:"field"},s.a.createElement("label",{className:"label",htmlFor:"search-input"},"Search Your ",this.state.collectionType,"s"),s.a.createElement("div",{className:"search-playlists-input-wrapper"},s.a.createElement("input",{id:"search-input",className:"search-input input",onChange:function(t){return e.search(t.target.value)},placeholder:"Search",value:this.state.query}),this.state.query.length?s.a.createElement("button",{onClick:function(){e.setState({query:""})}},s.a.createElement(X.a,{className:"has-text-link"})):null)),this.state.errorFetching?s.a.createElement("p",{className:"notification is-danger"},"Error Loading ",this.state.collectionType,"s, Refresh the Page"):s.a.createElement("div",{className:"playlists-wrapper"},t.length?t.map((function(t){return s.a.createElement("div",{key:Object(L.a)(),className:"playlist-wrapper has-background-grey-lighter",onClick:function(){return e.open(t.id,t.name)}},t.images[0]?s.a.createElement("img",{className:"cover-image",src:t.images[0].url}):s.a.createElement("div",{className:"cover-image"}),s.a.createElement("p",null,t.name))})):this.state.fetching?null:s.a.createElement("p",null,"no results")))))}}]),a}(n.Component);var me=Object(u.compose)(l.f,Object(o.b)((function(e){return{}}),(function(e){return{authenticate:function(){return e({type:"AUTHENTICATE"})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}})))(pe),he=function(e,t){var a=function(a){Object(A.a)(r,a);var n=Object(R.a)(r);function r(){return Object(S.a)(this,r),n.apply(this,arguments)}return Object(N.a)(r,[{key:"componentDidMount",value:function(){this.checkAndRedirect()}},{key:"componentDidUpdate",value:function(){this.checkAndRedirect()}},{key:"checkAndRedirect",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.isAuthenticated){e.next=3;break}return e.abrupt("return");case 3:return t=Object(L.a)(),e.prev=4,this.props.addPendingRequest({id:t,message:"Fetching Profile",type:b.PROFILE}),e.next=8,D.a.post("".concat(w,"/spotify-request"),{spotify_path:"https://api.spotify.com/v1/me",spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 8:if(a=e.sent,this.props.finishPendingRequest(t),!a.data||!a.data.id){e.next=13;break}return this.props.authenticate(a.data.id),e.abrupt("return");case 13:this.props.history.push("/home"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),this.props.finishPendingRequest(t);case 19:case"end":return e.stop()}}),e,this,[[4,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return s.a.createElement("div",null,this.props.isAuthenticated?s.a.createElement(e,(this.props,t)):null)}}]),r}(s.a.Component);return Object(u.compose)(l.f,Object(o.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{authenticate:function(t){return e({type:"AUTHENTICATE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}})))(a)},fe=function(e,t,a,n){return e===t?s.a.createElement("th",{onClick:function(e){return n(e)}},e,0!==a&&a?null:s.a.createElement(s.a.Fragment,null,"\u2191\u2193"),1===a?s.a.createElement(s.a.Fragment,null,"\u2191"):null,2===a?s.a.createElement(s.a.Fragment,null,"\u2193"):null):s.a.createElement("th",{onClick:function(e){n(e)}},e,"\u2191\u2193")},ye=function(e){Object(A.a)(a,e);var t=Object(R.a)(a);function a(e){var n;Object(S.a)(this,a),n=t.call(this,e);var s=localStorage.getItem("tonalify_selection"),r=JSON.parse(s);return n.state={trackList:[],filtered:!1,key:null,mode:null,sort:{column:null,direction:null},errorFetching:!1,disableTable:!1,query:"",trackSelection:r||[],modalActive:!1,fetchingAnalysis:!1,trackAnalysis:{},trackToAnalyze:{}},ne(),n}return Object(N.a)(a,[{key:"filterByKey",value:function(e){"key"!==e.target.name?"mode"===e.target.name&&this.setState({mode:e.target.value,filtered:!!e.target.value||!!this.state.key}):this.setState({key:e.target.value,filtered:!!e.target.value||!!this.state.mode})}},{key:"getFilteredTracks",value:function(){var e=this,t=this.state,a=t.key,n=t.mode,s=Object(m.a)(this.state.trackSelection).filter((function(e){return a&&n&&e.key===a&&e.mode===n||a&&!n&&e.key===a||!a&&n&&e.mode===n?e:a||n?void 0:e}));return this.state.query?s.filter((function(t){var a=t.name,n=t.artist,s=t.tempo,r=t.mode,i=t.key,c=!1;if([a,n,s,r,i].map((function(t){t&&t.toString().toLowerCase().includes(e.state.query.toLocaleLowerCase())&&(c=!0)})),c)return t})):s}},{key:"search",value:function(e){e.target.value&&e.target.value.length?this.setState({query:e.target.value,filtered:!0}):this.setState({query:"",filtered:!1})}},{key:"removeFromSelection",value:function(e){var t=localStorage.getItem("tonalify_selection"),a=(JSON.parse(t)?JSON.parse(t):[]).filter((function(t){return t.id!==e.id}));localStorage.setItem("tonalify_selection",JSON.stringify(a)),this.setState({trackSelection:a})}},{key:"addToSelection",value:function(e){var t=localStorage.getItem("tonalify_selection"),a=JSON.parse(t)?JSON.parse(t):[],n=[].concat(Object(m.a)(a),[e]);localStorage.setItem("tonalify_selection",JSON.stringify(n)),this.setState({trackSelection:n})}},{key:"exportSelection",value:function(){var e=Object(q.a)(I.a.mark((function e(t){var a,n,s,r,i,c,l;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=Object(L.a)(),n=Object(L.a)(),s=t.target.playlist_name.value,r=t.target.playlist_description.value,e.prev=5,this.props.addPendingRequest({id:a,type:b.USER_LIBRARY,message:"Creating New Playlist"}),e.next=9,D.a.post("".concat(w,"/spotify-request"),{spotify_path:"https://api.spotify.com/v1/users/".concat(this.props.userId,"/playlists"),spotify_payload:{name:s,description:r},crud_operation:"post"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 9:if(i=e.sent,this.props.finishPendingRequest(a),i&&i.data&&i.data.id){e.next=13;break}return e.abrupt("return");case 13:return this.props.addPendingRequest({id:n,type:b.USER_LIBRARY,message:"Adding Tracks To Playlist"}),c=this.state.filtered?this.getFilteredTracks():this.state.trackSelection,e.next=17,D.a.post("".concat(w,"/spotify-request"),{spotify_path:"https://api.spotify.com/v1/playlists/".concat(i.data.id,"/tracks"),spotify_payload:{uris:c.map((function(e){return e.uri}))},crud_operation:"post"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 17:if((l=e.sent)&&l.data&&l.data.snapshot_id){e.next=20;break}return e.abrupt("return");case 20:this.props.finishPendingRequest(n),this.props.addFlashMessage({type:v.SUCCESS,text:"Created ".concat(s),id:Object(L.a)()}),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(5),this.props.finishPendingRequest(n),this.props.finishPendingRequest(a),this.props.addFlashMessage({type:v.ERROR,text:"Error Creating Playlist",id:Object(L.a)()});case 29:case"end":return e.stop()}}),e,this,[[5,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(L.a)(),e.prev=1,this.props.addPendingRequest({id:t,type:b.PROFILE,message:"Logging In"}),e.next=5,D.a.get("".concat(w,"/login"));case 5:if(a=e.sent,this.props.finishPendingRequest(t),!a||!a.data){e.next=10;break}return window.location.href=a.data,e.abrupt("return");case 10:this.props.addFlashMessage({type:v.ERROR,text:"Error Fetching Login URL",id:Object(L.a)()}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),this.props.finishPendingRequest(t),this.props.addFlashMessage({type:v.ERROR,text:"Error Fetching Login URL",id:Object(L.a)()});case 17:case"end":return e.stop()}}),e,this,[[1,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"sortColumn",value:function(e){var t=1;if(this.state.sort.column!==e)t=1;else switch(this.state.sort.direction){case 0:t=1;break;case 1:t=2;break;case 2:t=0}this.setState({sort:{column:e,direction:t}})}},{key:"getSortedTracks",value:function(e){var t=this.state.sort,a=t.direction,n=t.column;return Object(m.a)(e).sort((function(e,t){return 1===a?e[n]>t[n]?1:-1:2===a?e[n]<t[n]?1:-1:1}))}},{key:"getAnalysis",value:function(){var e=Object(q.a)(I.a.mark((function e(t){var a,n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(L.a)(),this.props.addPendingRequest({id:a,type:b.USER_LIBRARY,message:"Fetching Audio Details"}),this.setState({fetchingAnalysis:!0,modalActive:!0,trackToAnalyze:t},(function(){Z(document.querySelector("#modal-content"))})),e.next=5,D.a.post("".concat(w,"/spotify-request"),{spotify_path:"https://api.spotify.com/v1/audio-analysis/".concat(t.id),spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 5:n=e.sent,this.props.finishPendingRequest(a),this.setState({trackAnalysis:n.data,fetchingAnalysis:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.filtered?this.getFilteredTracks():this.state.trackSelection,a=this.getSortedTracks(t),n=this.state,r=n.fetchingAnalysis,i=n.trackAnalysis,l=n.trackToAnalyze,o=n.trackSelection,u=this.props.isAuthenticated;return s.a.createElement("div",{className:"user-selection-wrapper"},this.state.modalActive?ae((function(){V(document.querySelector("#modal-content")),e.setState({modalActive:!1})}),r,i,l,o,(function(t){return e.addToSelection(t)}),(function(t){return e.removeFromSelection(t)})):null,this.state.errorFetching?s.a.createElement("p",{className:"notification is-danger"},"Error Loading Track Selection, Refresh the Page"):s.a.createElement(s.a.Fragment,null,u?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container has-text-centered is-widescreen"},s.a.createElement("p",{className:"title"},"Export To Spotify"),s.a.createElement("p",null,"Modify and export your current selection or return to your"," ",s.a.createElement(c.b,{to:"/your-playlists"},"Playlists")," and"," ",s.a.createElement(c.b,{to:"/your-albums"},"Albums")," to continue adding tracks"))),s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"columns is-centered"},s.a.createElement("div",{className:"form-wrapper box column is-half"},s.a.createElement("div",{className:"has-text-centered"},s.a.createElement("p",null,"Export Playlist")),s.a.createElement("form",{id:"playlist-form",className:"create-playlist-form",onSubmit:function(t){return e.exportSelection(t)}},s.a.createElement("div",{className:"playlist-inputs"},s.a.createElement("div",{className:"field"},s.a.createElement("label",{htmlFor:"name",className:"label"},"Name"),s.a.createElement("input",{id:"name",className:"input",name:"playlist_name",placeholder:"Playlist Name"})),s.a.createElement("div",{className:"field"},s.a.createElement("label",{htmlFor:"description",className:"label"},"Description"),s.a.createElement("textarea",{id:"description",rows:2,className:"playlist-description textarea",name:"playlist_description",placeholder:"Playlist Description"}))),s.a.createElement("div",{className:"export-button-wrapper"},s.a.createElement("button",{className:"export-button button is-primary"},"Create"))))))):s.a.createElement("div",{className:"section"},s.a.createElement("div",{className:"container has-text-centered is-widescreen"},s.a.createElement("p",{className:"title"},"Export To Spotify"),s.a.createElement("p",null,s.a.createElement("a",{href:"",onClick:function(){return e.login()}},"Login")," ","to Export your selection to a spotify playlist. The selection will still be here after logging in"))),s.a.createElement("div",{className:"table-section-wrapper"},s.a.createElement("div",{className:"table-wrapper"},this.state.disableTable?s.a.createElement("div",{className:"table-ajax-cover"},s.a.createElement("div",{className:"ajax-spinner"},s.a.createElement("div",{className:"spinner"}))):null,s.a.createElement("div",{className:"table-controls-wrapper"},s.a.createElement("div",{className:"key-and-mode-filter-wrapper"},s.a.createElement("form",{onChange:function(t){e.filterByKey(t)}},s.a.createElement("div",{className:"filter-wrapper"},s.a.createElement("div",{className:"select"},s.a.createElement("select",{name:"key"},s.a.createElement("option",{selected:!this.state.key,disabled:!0,value:""},"Key"),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map((function(e){return s.a.createElement("option",{key:Object(L.a)(),value:e},e)})))),this.state.key?s.a.createElement("button",{onClick:function(t){return e.setState({key:null})}},s.a.createElement(X.a,{className:"has-text-link"})):null),s.a.createElement("div",{className:"filter-wrapper"},s.a.createElement("div",{className:"select"},s.a.createElement("select",{name:"mode"},s.a.createElement("option",{selected:!this.state.mode,disabled:!0,value:""},"mode"),s.a.createElement("option",{value:"major"},"major"),s.a.createElement("option",{value:"minor"},"minor"))),this.state.mode?s.a.createElement("button",{onClick:function(t){return e.setState({mode:null})}},s.a.createElement(X.a,{className:"has-text-link"})):null))),s.a.createElement("div",{className:"search-input-wrapper field"},s.a.createElement("input",{className:"input is-small",onChange:function(t){return e.search(t)},placeholder:"Search",value:this.state.query}),this.state.query.length?s.a.createElement("button",{onClick:function(){e.setState({query:""})}},s.a.createElement(X.a,{className:"has-text-link"})):null," ")),s.a.createElement("table",{className:"table is-bordered is-striped "},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"deselect"),fe("name",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("name")})),fe("key",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("key")})),fe("mode",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("mode")})),fe("tempo",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("tempo")})),fe("artist",this.state.sort.column,this.state.sort.direction,(function(t){t.preventDefault(),e.sortColumn("artist")})))),s.a.createElement("tbody",null,a.map((function(t){return s.a.createElement("tr",{key:Object(L.a)()},s.a.createElement("td",{align:"center"},s.a.createElement(K.a,{className:"selection-button-icon has-text-link ".concat(e.state.disableTable?"disabled-icon":""),onClick:function(){e.removeFromSelection(t)}})),s.a.createElement("td",null,s.a.createElement("a",{onClick:function(){return e.getAnalysis(t)}},t.name)),s.a.createElement("td",null,t.key),s.a.createElement("td",null,t.mode),s.a.createElement("td",null,Number(t.tempo)),s.a.createElement("td",null,t.artist))}))))))))}}]),a}(n.Component);var ge=Object(o.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated,userId:e.auth.id}}),(function(e){return{addFlashMessage:function(t){return e({type:"ADD_FLASH_MESSAGE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}}))(ye),Ee=function(e){Object(A.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={},n}return Object(N.a)(a,[{key:"render",value:function(){var e=this.props.requests,t=e[e.length-1];return t?s.a.createElement("div",{className:"spinner-wrapper"},s.a.createElement("div",{className:"spinner-content"},s.a.createElement("div",null,s.a.createElement("div",{className:"spinner"})),t?s.a.createElement("p",null,t.message):null)):null}}]),a}(n.Component),be=Object(o.b)((function(e){return{requests:e.ajax.requests}}),(function(e){return{}}))(Ee),ve=function(e,t){var a=function(a){Object(A.a)(r,a);var n=Object(R.a)(r);function r(){return Object(S.a)(this,r),n.apply(this,arguments)}return Object(N.a)(r,[{key:"componentDidMount",value:function(){this.check()}},{key:"componentDidUpdate",value:function(){this.check()}},{key:"check",value:function(){var e=Object(q.a)(I.a.mark((function e(){var t,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.isAuthenticated){e.next=3;break}return e.abrupt("return");case 3:return t=Object(L.a)(),e.prev=4,this.props.addPendingRequest({id:t,message:"Fetching Profile",type:b.PROFILE}),e.next=8,D.a.post("".concat(w,"/spotify-request"),{spotify_path:"https://api.spotify.com/v1/me",spotify_payload:null,crud_operation:"get"},{withCredentials:!0,headers:{"Access-Control-Allow-Origin":x}});case 8:if(a=e.sent,this.props.finishPendingRequest(t),!a.data||!a.data.id){e.next=13;break}return this.props.authenticate(a.data.id),e.abrupt("return");case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),this.props.finishPendingRequest(t);case 18:case"end":return e.stop()}}),e,this,[[4,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return s.a.createElement(e,(this.props,t))}}]),r}(s.a.Component);return Object(u.compose)(l.f,Object(o.b)((function(e){return{isAuthenticated:e.auth.isAuthenticated}}),(function(e){return{authenticate:function(t){return e({type:"AUTHENTICATE",payload:t})},addPendingRequest:function(t){return e({type:"ADD_PENDING_REQUEST",payload:t})},finishPendingRequest:function(t){return e({type:"FINISH_PENDING_REQUEST",payload:t})}}})))(a)},ke=Object(u.createStore)(Object(u.combineReducers)(k),Object(p.composeWithDevTools)(Object(u.applyMiddleware)(d.a)));ne();var Se=function(){return s.a.createElement(o.a,{store:ke},s.a.createElement(c.a,null,s.a.createElement("div",null,s.a.createElement(be,null),s.a.createElement(_,null),s.a.createElement(G,null),s.a.createElement(l.c,null,s.a.createElement(l.a,{path:"/search",component:ve(oe)}),s.a.createElement(l.a,{path:"/your-playlists",component:he(me,{type:"PLAYLISTS"})}),s.a.createElement(l.a,{path:"/your-albums",component:he(me,{type:"ALBUMS"})}),s.a.createElement(l.a,{path:"/tracks",component:ve(ce)}),s.a.createElement(l.a,{path:"/selection",component:ve(ge)}),s.a.createElement(l.a,{path:"/"},s.a.createElement(de,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(Se,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[54,1,2]]]);
//# sourceMappingURL=main.f2f43a68.chunk.js.map